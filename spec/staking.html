<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Staking &mdash; interBTC Specification  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Escrow" href="escrow.html" />
    <link rel="prev" title="Reward" href="reward.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: grey" >
            <a href="../index.html" class="icon icon-home"> interBTC Specification
          </a>
              <div class="version">
                v5.6.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/at-a-glance.html">interBTC at a Glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/CbA.html">Cryptocurrency-backed Assets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/polkadot.html">Polkadot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/bitcoin.html">Bitcoin Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/accepted-format.html">Accepted Bitcoin Transaction Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">How to Read This Specification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Specification</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="btc-relay/index.html">BTC-Relay</a></li>
<li class="toctree-l1"><a class="reference internal" href="collateral.html">Collateral</a></li>
<li class="toctree-l1"><a class="reference internal" href="currency.html">Currency</a></li>
<li class="toctree-l1"><a class="reference internal" href="fee.html">Fee</a></li>
<li class="toctree-l1"><a class="reference internal" href="oracle.html">Oracle</a></li>
<li class="toctree-l1"><a class="reference internal" href="issue.html">Issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="refund.html">Refund</a></li>
<li class="toctree-l1"><a class="reference internal" href="redeem.html">Redeem</a></li>
<li class="toctree-l1"><a class="reference internal" href="replace.html">Replace</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="relay.html">Relay</a></li>
<li class="toctree-l1"><a class="reference internal" href="treasury.html">Treasury</a></li>
<li class="toctree-l1"><a class="reference internal" href="vault-registry.html">Vault Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="nomination.html">Vault Nomination</a></li>
<li class="toctree-l1"><a class="reference internal" href="reward.html">Reward</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Staking</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-model">Data Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#maps">Maps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#totalstake">TotalStake</a></li>
<li class="toctree-l4"><a class="reference internal" href="#totalcurrentstake">TotalCurrentStake</a></li>
<li class="toctree-l4"><a class="reference internal" href="#totalrewards">TotalRewards</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rewardpertoken">RewardPerToken</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rewardtally">RewardTally</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stake">Stake</a></li>
<li class="toctree-l4"><a class="reference internal" href="#slashpertoken">SlashPerToken</a></li>
<li class="toctree-l4"><a class="reference internal" href="#slashtally">SlashTally</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nonce">Nonce</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#functions">Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#depositstake">depositStake</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#specification">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#withdrawstake">withdrawStake</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#slashstake">slashStake</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id7">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#computestakeatindex">computeStakeAtIndex</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id9">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#distributereward">distributeReward</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id10">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#computerewardatindex">computeRewardAtIndex</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id11">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#withdrawrewardatindex">withdrawRewardAtIndex</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id13">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#forcerefund">forceRefund</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id15">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#staking-depositstakeevent">DepositStake</a></li>
<li class="toctree-l3"><a class="reference internal" href="#staking-withdrawstakeevent">WithdrawStake</a></li>
<li class="toctree-l3"><a class="reference internal" href="#staking-distributerewardevent">DistributeReward</a></li>
<li class="toctree-l3"><a class="reference internal" href="#withdrawreward">WithdrawReward</a></li>
<li class="toctree-l3"><a class="reference internal" href="#forcerefundevent">ForceRefund</a></li>
<li class="toctree-l3"><a class="reference internal" href="#increasenonce">IncreaseNonce</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="escrow.html">Escrow</a></li>
<li class="toctree-l1"><a class="reference internal" href="governance.html">Governance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Security and Performance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/liquidations.html">Vault Liquidations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/xclaim-security.html">XCLAIM Security Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/btcrelay-security.html">BTC-Relay Security Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/performance.html">Performance Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Economics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../economics/incentives.html">Economic Incentives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../economics/fees.html">Fee Model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">All the rest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../other/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../other/interlay.html">Interlay</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: grey" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">interBTC Specification</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Staking</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/spec/staking.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="staking">
<span id="id1"></span><h1>Staking<a class="headerlink" href="#staking" title="Permalink to this headline"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>This pallet is very similar to the <a class="reference internal" href="reward.html#rewards"><span class="std std-ref">Reward</span></a> pallet - it is also based on the <a class="reference external" href="https://solmaz.io/2019/02/24/scalable-reward-changing/">Scalable Reward Distribution</a> algorithm. The reward pallet keeps track of how much rewards vaults have earned. However, when nomination is enabled, there needs to be a way to relay parts of the vault’s rewards to its nominators. Furthermore, the nominator’s collaterals can be consumed, e.g., when a redeem is cancelled. This pallet is responsible for both tracking the rewards, and the current amount of contributed collaterals of vaults and nominators.</p>
<p>The idea is to have one reward pool per vault, where both the vault and all of its nominators have a stake equal to their contributed collateral. However, when collateral is consumed, either in <a class="reference internal" href="redeem.html#cancelredeem"><span class="std std-ref">cancelRedeem</span></a> or <a class="reference internal" href="vault-registry.html#liquidatevault"><span class="std std-ref">liquidateVault</span></a>, the collateral of each of these stakeholders should decrease proportionally to their stake. To be able to achieve this without iteration, in addition to tracking <code class="docutils literal notranslate"><span class="pre">RewardPerToken</span></code>, a similar value <code class="docutils literal notranslate"><span class="pre">SlashPerToken</span></code> is introduced. Similarly, in addition to <code class="docutils literal notranslate"><span class="pre">RewardTally</span></code>, we now also maintain a <code class="docutils literal notranslate"><span class="pre">SlashTally</span></code> is for each stakeholder. When calculating a reward for a stakeholder, a compensated stake is calculated, based on <code class="docutils literal notranslate"><span class="pre">Stake</span></code>, <code class="docutils literal notranslate"><span class="pre">SlashPerToken</span></code> and <code class="docutils literal notranslate"><span class="pre">SlashTally</span></code>.</p>
<p>When a vault opts out of nomination, all nominators should receive their collateral back. This is achieved by distributing all funds from the vault’s shared collateral as rewards. However, a vault is free to opt back into nominator after having opted out. It is possible for the vault to do this before all nominators have withdrawn their reward. To ensure that the bookkeeping remains intact for the nominators to get their rewards at a later point, all variables are additionally indexed by a nonce, which increases every time a vault opts out of nomination. Effectively, this create a new pool for every nominated period.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Most of the functions in this pallet that have a <code class="docutils literal notranslate"><span class="pre">_at_index</span></code> also have a version without this suffix that does not take a <code class="docutils literal notranslate"><span class="pre">nonce</span></code> argument, and instead uses the value stored in <a class="reference internal" href="#nonce"><span class="std std-ref">Nonce</span></a>. For brevity, these functions without the suffix are omitted in this specification.</p>
</div>
</section>
<section id="data-model">
<h2>Data Model<a class="headerlink" href="#data-model" title="Permalink to this headline"></a></h2>
<section id="maps">
<h3>Maps<a class="headerlink" href="#maps" title="Permalink to this headline"></a></h3>
<section id="totalstake">
<h4>TotalStake<a class="headerlink" href="#totalstake" title="Permalink to this headline"></a></h4>
<p>Maps <code class="docutils literal notranslate"><span class="pre">(currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId)</span></code> to the total stake deposited by the given vault and its nominators, with the given nonce and currencyId.</p>
</section>
<section id="totalcurrentstake">
<h4>TotalCurrentStake<a class="headerlink" href="#totalcurrentstake" title="Permalink to this headline"></a></h4>
<p>Maps <code class="docutils literal notranslate"><span class="pre">(currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId)</span></code> to the total stake deposited by the given vault and its nominators, with the given nonce and currencyId, excluding stake that has been slashed.</p>
</section>
<section id="totalrewards">
<h4>TotalRewards<a class="headerlink" href="#totalrewards" title="Permalink to this headline"></a></h4>
<p>Maps <code class="docutils literal notranslate"><span class="pre">(currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId)</span></code> to the total rewards distributed to the vault and its nominators. This value is currently only used for testing purposes.</p>
</section>
<section id="rewardpertoken">
<span id="id2"></span><h4>RewardPerToken<a class="headerlink" href="#rewardpertoken" title="Permalink to this headline"></a></h4>
<p>Maps <code class="docutils literal notranslate"><span class="pre">(currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId)</span></code> to the amount of reward the vault and its nominators get per unit of stake.</p>
</section>
<section id="rewardtally">
<span id="id3"></span><h4>RewardTally<a class="headerlink" href="#rewardtally" title="Permalink to this headline"></a></h4>
<p>Maps <code class="docutils literal notranslate"><span class="pre">(currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId)</span></code> to the reward tally the given nominator has for the given vault’s reward pool, in the given nonce and currency. The tally influences how much the nominator can withdraw.</p>
</section>
<section id="stake">
<h4>Stake<a class="headerlink" href="#stake" title="Permalink to this headline"></a></h4>
<p>Maps <code class="docutils literal notranslate"><span class="pre">(currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId)</span></code> to the stake the given nominator has in the given vault’s reward pool, in the given nonce and currency. Initially, the stake is equal to its contributed collateral. However, after a slashing has occurred, the nominator’s collateral must be compensated, using <a class="reference internal" href="#computestakeatindex"><span class="std std-ref">computeStakeAtIndex</span></a>.</p>
</section>
<section id="slashpertoken">
<h4>SlashPerToken<a class="headerlink" href="#slashpertoken" title="Permalink to this headline"></a></h4>
<p>Akin to <a class="reference internal" href="#rewardpertoken"><span class="std std-ref">RewardPerToken</span></a>: maps <code class="docutils literal notranslate"><span class="pre">(currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId)</span></code> to the amount the vault and its nominators got slashed for per unit of stake. It is used for computing the effective stake (or equivalently, its collateral) in <a class="reference internal" href="#computestakeatindex"><span class="std std-ref">computeStakeAtIndex</span></a>.</p>
</section>
<section id="slashtally">
<h4>SlashTally<a class="headerlink" href="#slashtally" title="Permalink to this headline"></a></h4>
<p>Akin to <a class="reference internal" href="#rewardtally"><span class="std std-ref">RewardTally</span></a>: maps <code class="docutils literal notranslate"><span class="pre">(currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId)</span></code> to the slash tally the given nominator has for the given vault’s reward pool, in the given nonce and currency. It is used for computing the effective stake (or equivalently, its collateral) in <a class="reference internal" href="#computestakeatindex"><span class="std std-ref">computeStakeAtIndex</span></a>.</p>
</section>
<section id="nonce">
<span id="id4"></span><h4>Nonce<a class="headerlink" href="#nonce" title="Permalink to this headline"></a></h4>
<p>Maps <code class="docutils literal notranslate"><span class="pre">(currencyId,</span> <span class="pre">vaultId)</span></code> current value of the nonce the given vault uses in the given currency. The nonce is increased every time <a class="reference internal" href="#forcerefund"><span class="std std-ref">forceRefund</span></a> is called, i.e., when a vault opts out of nomination. Since nominators get their collateral back as a withdrawable reward, the bookkeeping must remain intact when the vault once again opts into nomination. By incrementing this nonce, effectively a new reward pool is created for the new session. All externally callable functions use the nonce stored in this map, except for the reward withdrawal function <a class="reference internal" href="#withdrawrewardatindex"><span class="std std-ref">withdrawRewardAtIndex</span></a>.</p>
</section>
</section>
</section>
<section id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline"></a></h2>
<section id="depositstake">
<span id="staking-depositstake"></span><h3>depositStake<a class="headerlink" href="#depositstake" title="Permalink to this headline"></a></h3>
<p>Adds a stake for the given account and currency in the reward pool.</p>
<section id="specification">
<h4>Specification<a class="headerlink" href="#specification" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">depositStake(currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: The currency for which to add the stake</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: Account of the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nominatorId</span></code>: Account of the nominator</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amount</span></code>: The amount by which the stake is to increase</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#staking-depositstakeevent"><span class="std std-ref">DepositStake</span></a></p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Stake[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId]</span></code> MUST increase by <code class="docutils literal notranslate"><span class="pre">amount</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TotalStake[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code> MUST increase by <code class="docutils literal notranslate"><span class="pre">amount</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TotalCurrentStake[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code> MUST increase by <code class="docutils literal notranslate"><span class="pre">amount</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RewardTally[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId]</span></code> MUST increase by <code class="docutils literal notranslate"><span class="pre">RewardPerToken[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span> <span class="pre">*</span> <span class="pre">amount</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SlashTally[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId]</span></code> MUST increase by <code class="docutils literal notranslate"><span class="pre">SlashPerToken[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span> <span class="pre">*</span> <span class="pre">amount</span></code>.</p></li>
</ul>
</section>
</section>
<section id="withdrawstake">
<span id="staking-withdrawstake"></span><h3>withdrawStake<a class="headerlink" href="#withdrawstake" title="Permalink to this headline"></a></h3>
<p>Withdraws the given amount stake for the given nominator or vault. This function also modifies the nominator’s <code class="docutils literal notranslate"><span class="pre">SlashTally</span></code> and <code class="docutils literal notranslate"><span class="pre">Stake</span></code>, such that the <code class="docutils literal notranslate"><span class="pre">Stake</span></code> is once again equal to its collateral.</p>
<section id="id5">
<h4>Specification<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">withdrawStake(currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: The currency for which to add the stake</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: Account of the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nominatorId</span></code>: Account of the nominator</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amount</span></code>: The amount by which the stake is to decrease</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#staking-withdrawstakeevent"><span class="std std-ref">WithdrawStake</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>Let <code class="docutils literal notranslate"><span class="pre">nonce</span></code> be <code class="docutils literal notranslate"><span class="pre">Nonce[currencyId,</span> <span class="pre">vaultId]</span></code>, and</p></li>
<li><p>Let <code class="docutils literal notranslate"><span class="pre">stake</span></code> be <code class="docutils literal notranslate"><span class="pre">Stake[nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId]</span></code>, and</p></li>
<li><p>Let <code class="docutils literal notranslate"><span class="pre">slashPerToken</span></code> be <code class="docutils literal notranslate"><span class="pre">SlashPerToken[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code>, and</p></li>
<li><p>Let <code class="docutils literal notranslate"><span class="pre">slashTally</span></code> be <code class="docutils literal notranslate"><span class="pre">slashTally[nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId]</span></code>, and</p></li>
<li><p>Let <code class="docutils literal notranslate"><span class="pre">toSlash</span></code> be <code class="docutils literal notranslate"><span class="pre">stake</span> <span class="pre">*</span> <span class="pre">slashPerToken</span> <span class="pre">-</span> <span class="pre">slashTally</span></code></p></li>
</ul>
<p>Then:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">stake</span> <span class="pre">-</span> <span class="pre">toSlash</span></code> MUST be greater than or equal to <code class="docutils literal notranslate"><span class="pre">amount</span></code></p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>Let <code class="docutils literal notranslate"><span class="pre">nonce</span></code> be <code class="docutils literal notranslate"><span class="pre">Nonce[currencyId,</span> <span class="pre">vaultId]</span></code>, and</p></li>
<li><p>Let <code class="docutils literal notranslate"><span class="pre">stake</span></code> be <code class="docutils literal notranslate"><span class="pre">Stake[nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId]</span></code>, and</p></li>
<li><p>Let <code class="docutils literal notranslate"><span class="pre">slashPerToken</span></code> be <code class="docutils literal notranslate"><span class="pre">SlashPerToken[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code>, and</p></li>
<li><p>Let <code class="docutils literal notranslate"><span class="pre">slashTally</span></code> be <code class="docutils literal notranslate"><span class="pre">slashTally[nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId]</span></code>, and</p></li>
<li><p>Let <code class="docutils literal notranslate"><span class="pre">toSlash</span></code> be <code class="docutils literal notranslate"><span class="pre">stake</span> <span class="pre">*</span> <span class="pre">slashPerToken</span> <span class="pre">-</span> <span class="pre">slashTally</span></code></p></li>
</ul>
<p>Then:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Stake[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId]</span></code> MUST decrease by <code class="docutils literal notranslate"><span class="pre">toSlash</span> <span class="pre">+</span> <span class="pre">amount</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TotalStake[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code> MUST decrease by <code class="docutils literal notranslate"><span class="pre">toSlash</span> <span class="pre">+</span> <span class="pre">amount</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TotalCurrentStake[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code> MUST decrease by <code class="docutils literal notranslate"><span class="pre">amount</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SlashTally[nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId]</span></code> MUST be set to <code class="docutils literal notranslate"><span class="pre">(stake</span> <span class="pre">-</span> <span class="pre">toSlash</span> <span class="pre">-</span> <span class="pre">amount)</span> <span class="pre">*</span> <span class="pre">slashPerToken</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RewardTally[nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId]</span></code> MUST decrease by <code class="docutils literal notranslate"><span class="pre">rewardPerToken</span> <span class="pre">*</span> <span class="pre">amount</span></code></p></li>
</ul>
</section>
</section>
<section id="slashstake">
<span id="id6"></span><h3>slashStake<a class="headerlink" href="#slashstake" title="Permalink to this headline"></a></h3>
<p>Slashes a vault’s stake in the given currency in the reward pool. Conceptually, this decreases the stakes, and thus the collaterals, of all of the vault’s stakeholders. Indeed, <a class="reference internal" href="#computestakeatindex"><span class="std std-ref">computeStakeAtIndex</span></a> will reflect the stake changes on the stakeholder.</p>
<section id="id7">
<h4>Specification<a class="headerlink" href="#id7" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">slashStake(currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: The currency for which to add the stake</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: Account of the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amount</span></code>: The amount by which the stake is to decrease</p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TotalStake[currencyId,</span> <span class="pre">Nonce[currencyId,</span> <span class="pre">vaultId],</span> <span class="pre">vaultId]</span></code> MUST NOT be zero</p></li>
</ul>
<p><em>Postconditions</em></p>
<p>Let <code class="docutils literal notranslate"><span class="pre">nonce</span></code> be <code class="docutils literal notranslate"><span class="pre">Nonce[currencyId,</span> <span class="pre">vaultId]</span></code>, and <code class="docutils literal notranslate"><span class="pre">initialTotalStake</span></code> be <code class="docutils literal notranslate"><span class="pre">TotalCurrentStake[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code>. Then:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SlashPerToken[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code> MUST increase by <code class="docutils literal notranslate"><span class="pre">amount</span> <span class="pre">/</span> <span class="pre">TotalStake[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TotalCurrentStake[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code> MUST decrease by <code class="docutils literal notranslate"><span class="pre">amount</span></code></p></li>
<li><p>if <code class="docutils literal notranslate"><span class="pre">initialTotalStake</span> <span class="pre">-</span> <span class="pre">amount</span></code> is NOT zero, <code class="docutils literal notranslate"><span class="pre">RewardPerToken[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code> MUST increase by <code class="docutils literal notranslate"><span class="pre">RewardPerToken[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span> <span class="pre">*</span> <span class="pre">amount</span> <span class="pre">/</span> <span class="pre">(initialTotalStake</span> <span class="pre">-</span> <span class="pre">amount)</span></code></p></li>
</ul>
</section>
</section>
<section id="computestakeatindex">
<span id="id8"></span><h3>computeStakeAtIndex<a class="headerlink" href="#computestakeatindex" title="Permalink to this headline"></a></h3>
<p>Computes a vault’s stakeholder’s effective stake. This is also the amount collateral that belongs to the stakeholder.</p>
<section id="id9">
<h4>Specification<a class="headerlink" href="#id9" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">computeStakeAtIndex(nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nonce</span></code>: The nonce to compute the stake at</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: The currency for which to compute the stake</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: Account of the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nominatorId</span></code>: Account of the nominator</p></li>
</ul>
<p><em>Postconditions</em></p>
<p>Let <code class="docutils literal notranslate"><span class="pre">stake</span></code> be <code class="docutils literal notranslate"><span class="pre">Stake[nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId]</span></code>, and
Let <code class="docutils literal notranslate"><span class="pre">slashPerToken</span></code> be <code class="docutils literal notranslate"><span class="pre">SlashPerToken[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code>, and
Let <code class="docutils literal notranslate"><span class="pre">slashTally</span></code> be <code class="docutils literal notranslate"><span class="pre">slashTally[nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId]</span></code>, then</p>
<ul class="simple">
<li><p>The function MUST return <code class="docutils literal notranslate"><span class="pre">stake</span> <span class="pre">-</span> <span class="pre">stake</span> <span class="pre">*</span> <span class="pre">slash_per_token</span> <span class="pre">+</span> <span class="pre">slash_tally</span></code>.</p></li>
</ul>
</section>
</section>
<section id="distributereward">
<span id="staking-distributereward"></span><h3>distributeReward<a class="headerlink" href="#distributereward" title="Permalink to this headline"></a></h3>
<p>Distributes rewards to the vault’s stakeholders.</p>
<section id="id10">
<h4>Specification<a class="headerlink" href="#id10" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">distributeReward(currencyId,</span> <span class="pre">reward)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: The currency being distributed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: the vault for which distribute rewards</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reward</span></code>: The amount being distributed</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#staking-distributerewardevent"><span class="std std-ref">DistributeReward</span></a></p></li>
</ul>
<p><em>Postconditions</em></p>
<p>Let <code class="docutils literal notranslate"><span class="pre">nonce</span></code> be <code class="docutils literal notranslate"><span class="pre">Nonce[currencyId,</span> <span class="pre">vaultId]</span></code>, and
Let <code class="docutils literal notranslate"><span class="pre">initialTotalCurrentStake</span></code> be <code class="docutils literal notranslate"><span class="pre">TotalCurrentStake[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code>, then:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">initialTotalCurrentStake</span></code> is zero, or if <code class="docutils literal notranslate"><span class="pre">reward</span></code> is zero, then:</p>
<ul>
<li><p>The function MUST return zero.</p></li>
</ul>
</li>
<li><p>Otherwise (if <code class="docutils literal notranslate"><span class="pre">initialTotalCurrentStake</span></code> and <code class="docutils literal notranslate"><span class="pre">reward</span></code> are not zero), then:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">RewardPerToken[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId)]</span></code> MUST increase by <code class="docutils literal notranslate"><span class="pre">reward</span> <span class="pre">/</span> <span class="pre">initialTotalCurrentStake</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TotalRewards[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code> MUST increase by <code class="docutils literal notranslate"><span class="pre">reward</span></code></p></li>
<li><p>The function MUST return <code class="docutils literal notranslate"><span class="pre">reward</span></code>.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="computerewardatindex">
<span id="staking-computerewardatindex"></span><h3>computeRewardAtIndex<a class="headerlink" href="#computerewardatindex" title="Permalink to this headline"></a></h3>
<p>Calculates the amount of rewards the vault’s stakeholder can withdraw.</p>
<section id="id11">
<h4>Specification<a class="headerlink" href="#id11" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">computeRewardAtIndex(nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nonce</span></code>: The nonce to compute the stake at</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: The currency for which to compute the stake</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: Account of the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nominatorId</span></code>: Account of the nominator</p></li>
</ul>
<p><em>Postconditions</em></p>
<p>Let <code class="docutils literal notranslate"><span class="pre">stake</span></code> be the result of <code class="docutils literal notranslate"><span class="pre">computeStakeAtIndex(nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId)</span></code>, then:
Let <code class="docutils literal notranslate"><span class="pre">rewardPerToken</span></code> be <code class="docutils literal notranslate"><span class="pre">RewardPerToken[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code>, and
Let <code class="docutils literal notranslate"><span class="pre">rewardTally</span></code> be <code class="docutils literal notranslate"><span class="pre">rewardTally[nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId]</span></code>, then</p>
<ul class="simple">
<li><p>The function MUST return <code class="docutils literal notranslate"><span class="pre">max(0,</span> <span class="pre">stake</span> <span class="pre">*</span> <span class="pre">rewardPerToken</span> <span class="pre">-</span> <span class="pre">reward_tally)</span></code></p></li>
</ul>
</section>
</section>
<section id="withdrawrewardatindex">
<span id="id12"></span><h3>withdrawRewardAtIndex<a class="headerlink" href="#withdrawrewardatindex" title="Permalink to this headline"></a></h3>
<p>Withdraws the rewards the given vault’s stakeholder has accumulated.</p>
<section id="id13">
<h4>Specification<a class="headerlink" href="#id13" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">withdrawRewardAtIndex(currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nonce</span></code>: The nonce to compute the stake at</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: The currency for which to compute the stake</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: Account of the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nominatorId</span></code>: Account of the nominator</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#staking-withdrawrewardevent"><span class="std std-ref">WithdrawReward</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">computeRewardAtIndex(nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId)</span></code> MUST NOT return an error</p></li>
</ul>
<p><em>Postconditions</em></p>
<p>Let <code class="docutils literal notranslate"><span class="pre">reward</span></code> be the result of <code class="docutils literal notranslate"><span class="pre">computeRewardAtIndex(nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId)</span></code>, then:
Let <code class="docutils literal notranslate"><span class="pre">stake</span></code> be <code class="docutils literal notranslate"><span class="pre">Stake(nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId)</span></code>, then:
Let <code class="docutils literal notranslate"><span class="pre">rewardPerToken</span></code> be <code class="docutils literal notranslate"><span class="pre">RewardPerToken[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId]</span></code>, and</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TotalRewards[currency_id,</span> <span class="pre">nonce,</span> <span class="pre">vault_id]</span></code> MUST decrease by <code class="docutils literal notranslate"><span class="pre">reward</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RewardTally[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId]</span></code> MUST be set to <code class="docutils literal notranslate"><span class="pre">stake</span> <span class="pre">*</span> <span class="pre">rewardPerToken</span></code></p></li>
<li><p>The function MUST return <code class="docutils literal notranslate"><span class="pre">reward</span></code></p></li>
</ul>
</section>
</section>
<section id="forcerefund">
<span id="id14"></span><h3>forceRefund<a class="headerlink" href="#forcerefund" title="Permalink to this headline"></a></h3>
<p>This is called when the vault opts out of nomination. All collateral is distributed among the stakeholders, after which the vault withdraws his part immediately.</p>
<section id="id15">
<h4>Specification<a class="headerlink" href="#id15" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">forceRefund(currencyId,</span> <span class="pre">vaultId)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: The currency for which to compute the stake</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: Account of the vault</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#forcerefundevent"><span class="std std-ref">ForceRefund</span></a></p></li>
<li><p><a class="reference internal" href="#increasenonceevent"><span class="std std-ref">IncreaseNonce</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<p>Let <code class="docutils literal notranslate"><span class="pre">nonce</span></code> be <code class="docutils literal notranslate"><span class="pre">Nonce[currencyId,</span> <span class="pre">vaultId]</span></code>, then:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">distributeReward(currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">TotalCurrentStake[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId])</span></code> MUST NOT return an error</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">withdrawRewardAtIndex(nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">vaultId)</span></code> MUST NOT return an error</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">depositStake(currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">vaultId,</span> <span class="pre">reward)</span></code> MUST NOT return an error</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Nonce[currencyId,</span> <span class="pre">vaultId]</span></code> MUST be increased by 1</p></li>
</ul>
<p><em>Postconditions</em></p>
<p>Let <code class="docutils literal notranslate"><span class="pre">nonce</span></code> be <code class="docutils literal notranslate"><span class="pre">Nonce[currencyId,</span> <span class="pre">vaultId]</span></code>, then:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">distributeReward(currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">TotalCurrentStake[currencyId,</span> <span class="pre">nonce,</span> <span class="pre">vaultId])</span></code> MUST have been called</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">withdrawRewardAtIndex(nonce,</span> <span class="pre">currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">vaultId)</span></code> MUST have been called</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Nonce[currencyId,</span> <span class="pre">vaultId]</span></code> MUST be increased by 1</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">depositStake(currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">vaultId,</span> <span class="pre">reward)</span></code> MUST have been called AFTER having increased the nonce</p></li>
</ul>
</section>
</section>
<section id="staking-depositstakeevent">
<span id="id16"></span><h3>DepositStake<a class="headerlink" href="#staking-depositstakeevent" title="Permalink to this headline"></a></h3>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">DepositStake(currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: The currency of the reward pool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: Account of the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nominatorId</span></code>: Account of the nominator</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amount</span></code>: The amount by which the stake is to increase</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#staking-depositstake"><span class="std std-ref">depositStake</span></a></p></li>
</ul>
</section>
<section id="staking-withdrawstakeevent">
<span id="id17"></span><h3>WithdrawStake<a class="headerlink" href="#staking-withdrawstakeevent" title="Permalink to this headline"></a></h3>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">WithdrawStake(currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: The currency of the reward pool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: Account of the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nominatorId</span></code>: Account of the nominator</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amount</span></code>: The amount by which the stake is to increase</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#staking-withdrawstake"><span class="std std-ref">withdrawStake</span></a></p></li>
</ul>
</section>
<section id="staking-distributerewardevent">
<span id="id18"></span><h3>DistributeReward<a class="headerlink" href="#staking-distributerewardevent" title="Permalink to this headline"></a></h3>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">DistributeReward(currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: The currency of the reward pool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: Account of the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amount</span></code>: The amount by which the stake is to increase</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#staking-distributereward"><span class="std std-ref">distributeReward</span></a></p></li>
</ul>
</section>
<section id="withdrawreward">
<span id="staking-withdrawrewardevent"></span><h3>WithdrawReward<a class="headerlink" href="#withdrawreward" title="Permalink to this headline"></a></h3>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">WithdrawReward(currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: The currency of the reward pool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: Account of the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nominatorId</span></code>: Account of the nominator</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amount</span></code>: The amount by which the stake is to increase</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#withdrawrewardatindex"><span class="std std-ref">withdrawRewardAtIndex</span></a></p></li>
</ul>
</section>
<section id="forcerefundevent">
<span id="id19"></span><h3>ForceRefund<a class="headerlink" href="#forcerefundevent" title="Permalink to this headline"></a></h3>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">ForceRefund(currencyId,</span> <span class="pre">vaultId)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: The currency of the reward pool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: Account of the vault</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#forcerefund"><span class="std std-ref">forceRefund</span></a></p></li>
</ul>
</section>
<section id="increasenonce">
<span id="increasenonceevent"></span><h3>IncreaseNonce<a class="headerlink" href="#increasenonce" title="Permalink to this headline"></a></h3>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">IncreaseNonce(currencyId,</span> <span class="pre">vaultId,</span> <span class="pre">nominatorId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: The currency of the reward pool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: Account of the vault</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amount</span></code>: The amount by which the stake is to increase</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#forcerefund"><span class="std std-ref">forceRefund</span></a></p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="reward.html" class="btn btn-neutral float-left" title="Reward" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="escrow.html" class="btn btn-neutral float-right" title="Escrow" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Interlay.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>