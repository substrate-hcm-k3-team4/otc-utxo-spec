<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vault Nomination &mdash; interBTC Specification  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Reward" href="reward.html" />
    <link rel="prev" title="Vault Registry" href="vault-registry.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: grey" >
            <a href="../index.html" class="icon icon-home"> interBTC Specification
          </a>
              <div class="version">
                v5.6.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/at-a-glance.html">interBTC at a Glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/CbA.html">Cryptocurrency-backed Assets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/polkadot.html">Polkadot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/bitcoin.html">Bitcoin Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/accepted-format.html">Accepted Bitcoin Transaction Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">How to Read This Specification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Specification</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="btc-relay/index.html">BTC-Relay</a></li>
<li class="toctree-l1"><a class="reference internal" href="collateral.html">Collateral</a></li>
<li class="toctree-l1"><a class="reference internal" href="currency.html">Currency</a></li>
<li class="toctree-l1"><a class="reference internal" href="fee.html">Fee</a></li>
<li class="toctree-l1"><a class="reference internal" href="oracle.html">Oracle</a></li>
<li class="toctree-l1"><a class="reference internal" href="issue.html">Issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="refund.html">Refund</a></li>
<li class="toctree-l1"><a class="reference internal" href="redeem.html">Redeem</a></li>
<li class="toctree-l1"><a class="reference internal" href="replace.html">Replace</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="relay.html">Relay</a></li>
<li class="toctree-l1"><a class="reference internal" href="treasury.html">Treasury</a></li>
<li class="toctree-l1"><a class="reference internal" href="vault-registry.html">Vault Registry</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Vault Nomination</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-by-step">Step-by-step</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#protocol">Protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#assumptions">Assumptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vault-nomination-protocol">Vault Nomination Protocol</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#max-nomination-ratio">Max Nomination Ratio</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#security-considerations">Security Considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#economic-security-without-vault-nomination">Economic Security without Vault Nomination</a></li>
<li class="toctree-l4"><a class="reference internal" href="#economic-security-with-vault-nomination">Economic Security with Vault Nomination</a></li>
<li class="toctree-l4"><a class="reference internal" href="#risk-summary">Risk Summary</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#data-model">Data Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scalars">Scalars</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#nominationenabled">NominationEnabled</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#maps">Maps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#vaults">Vaults</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#structs">Structs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#functions">Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setnominationenabled">setNominationEnabled</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#specification">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#optintonomination">optInToNomination</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#optoutofnomination">optOutOfNomination</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id7">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#depositcollateral">depositCollateral</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#withdrawcollateral">withdrawCollateral</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id9">Specification</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#events">Events</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#nominationoptin">NominationOptIn</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nominationoptout">NominationOptOut</a></li>
<li class="toctree-l3"><a class="reference internal" href="#depositnominationcollateralevent">DepositCollateral</a></li>
<li class="toctree-l3"><a class="reference internal" href="#withdrawnominationcollateralevent">WithdrawCollateral</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reward.html">Reward</a></li>
<li class="toctree-l1"><a class="reference internal" href="staking.html">Staking</a></li>
<li class="toctree-l1"><a class="reference internal" href="escrow.html">Escrow</a></li>
<li class="toctree-l1"><a class="reference internal" href="governance.html">Governance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Security and Performance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/liquidations.html">Vault Liquidations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/xclaim-security.html">XCLAIM Security Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/btcrelay-security.html">BTC-Relay Security Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/performance.html">Performance Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Economics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../economics/incentives.html">Economic Incentives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../economics/fees.html">Fee Model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">All the rest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../other/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../other/interlay.html">Interlay</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: grey" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">interBTC Specification</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Vault Nomination</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/spec/nomination.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="vault-nomination">
<span id="id1"></span><h1>Vault Nomination<a class="headerlink" href="#vault-nomination" title="Permalink to this headline"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>Nomination is a feature aimed at increasing <cite>interBTC</cite> issuance capacity by allowing Nominators to back a particular Vault.
Nominators lock their free collateral so that trusted Vaults can issue <cite>interBTC</cite> backed by the nominated collateral.
Nominators are rewarded a fraction of the fees generated by the Vault, while the remaining fees are given to the Vault.
Vaults are assumed to be trusted by their Nominators not to steal Bitcoin backed by nominated collateral.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The current specification requires some level of trust between the Vault and its Nominators. The specification will be revised before this feature goes live to keep the same security model as XCLAIM where Nominators would not trust Vaults.</p>
</div>
<section id="step-by-step">
<h3>Step-by-step<a class="headerlink" href="#step-by-step" title="Permalink to this headline"></a></h3>
<ol class="arabic simple">
<li><p>Vaults may opt in to Nomination, expanding the total possible issuance amount.</p></li>
<li><p>The maximum amount that can be nominated is bounded by the Vault’s locked collateral.</p></li>
<li><p>Nominators select one or more Vaults and lock their collateral balance on the BTC Parachain. The used currency for each nomination is determined by the vault’s collateral currency. If a nominator is nominating different vaults, a different currency can be used for each vault, i.e., a nominator is not limited to a single currency.</p></li>
<li><p>Nominators can go offline and their nominated collateral will generate rewards passively.</p></li>
<li><p>Vaults and Nominators can withdraw their collateral at any point subject to the <code class="docutils literal notranslate"><span class="pre">SecureCollateralThreshold</span></code>.</p></li>
<li><p>Upon liquidation, Nominators are returned some collateral after remaining requests have been executed.</p></li>
</ol>
</section>
</section>
<section id="protocol">
<h2>Protocol<a class="headerlink" href="#protocol" title="Permalink to this headline"></a></h2>
<section id="assumptions">
<h3>Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this headline"></a></h3>
<p><strong>Security Assumptions</strong></p>
<ol class="arabic simple">
<li><p>The operating Vault is trusted by its Nominators not to steal the <cite>interBTC</cite> issued with their collateral.</p></li>
<li><p>There is no transitive trust. If a user trusts Vault A and Vault A trusts Vault B, the user does not trust Vault B.</p></li>
</ol>
<p><strong>Liveness Assumptions</strong></p>
<ol class="arabic simple">
<li><p>Nominators are mostly-offline agents, who are slow to respond to system changes.</p></li>
<li><p>Vaults are always-online agents, who can promptly react to system updates.</p></li>
</ol>
</section>
<section id="vault-nomination-protocol">
<h3>Vault Nomination Protocol<a class="headerlink" href="#vault-nomination-protocol" title="Permalink to this headline"></a></h3>
<ol class="arabic simple">
<li><p>Vaults must choose to opt in to the Nomination protocol.</p></li>
<li><p>Nominators select a Vault to which they can delegate collateral. They will earn a fraction of any rewards generated by the Vault.</p></li>
<li><p>Vault replacement is disallowed with nominated collateral. Otherwise, Security Assumptions 1 and 2 would be violated.</p></li>
<li><p>The nominated collateral:</p>
<ol class="arabic simple">
<li><p>Is in the vault’s collateral currency,</p></li>
<li><p>Cannot be withdrawn by the Vault,</p></li>
<li><p>Is locked on the parachain,</p></li>
<li><p>Is capped at a fraction of the Vault’s deposited collateral (<a class="reference internal" href="#maxnominationratio"><span class="std std-ref">Max Nomination Ratio</span></a>) to bound the risk for both Vaults and Nominators.</p></li>
</ol>
</li>
<li><p>Liquidation slashing is handled as follows:</p>
<ol class="arabic simple">
<li><p><strong>Proportional Slashing</strong> In case the collateral managed by the Vault falls below the liquidation threshold, the Vault and its Nominators are slashed proportionally to their collateral.</p></li>
<li><p><strong>Vault First Slashing</strong> In case the Vault steals Bitcoin deposited at its address, its collateral is used to cover as much of the slashed amount as possible. If the Vault’s collateral was not enough to cover the entire amount, the Nominators are slashed proportionally for the remaining amount.</p></li>
</ol>
</li>
<li><p>Vaults may opt out of the Nomination protocol which force refunds Nominators if there is enough collateral over the <code class="docutils literal notranslate"><span class="pre">SecureCollateralThreshold</span></code>.</p></li>
</ol>
<section id="max-nomination-ratio">
<span id="maxnominationratio"></span><h4>Max Nomination Ratio<a class="headerlink" href="#max-nomination-ratio" title="Permalink to this headline"></a></h4>
<p>This ratio prevents the Vault from withdrawing its entire collateral and only exposing Nominators to economic risk, or stealing without liquidation consequences.
This means that a Vault can only withdraw collateral as long as the fraction of nominated collateral does not exceed the threshold cap.
Capping Nominator collateral also prevents Vaults being “outnumbered” by Nominators and their relative fee earnings being marginalized.
The calculation is defined in <a class="reference internal" href="vault-registry.html#vault-registry"><span class="std std-ref">Vault Registry</span></a>, in the <code class="docutils literal notranslate"><span class="pre">getMaxNominationRatio</span></code> function.</p>
</section>
</section>
<section id="security-considerations">
<span id="securityconsiderations"></span><h3>Security Considerations<a class="headerlink" href="#security-considerations" title="Permalink to this headline"></a></h3>
<p>The Vault Nomination protocol changes the economic incentive for Vaults to misbehave, i.e., violate the security of the XCLAIM protocol by stealing BTC.</p>
<section id="economic-security-without-vault-nomination">
<h4>Economic Security without Vault Nomination<a class="headerlink" href="#economic-security-without-vault-nomination" title="Permalink to this headline"></a></h4>
<p>Informally and not considering reputation or rewards, a rational Vault should not steal BTC if the economic value of the collateral is above the value of the BTC held in custody.
The <em>effective collateralization</em> rate at which Vaults should steal BTC is below 100%.
More formally, we can express this as:</p>
<div class="math notranslate nohighlight">
\[C &gt; b\]</div>
<p>Where <span class="math notranslate nohighlight">\(C\)</span> is the value of the locked collateral (e.g., DOT) and <span class="math notranslate nohighlight">\(b\)</span> is the value of the backing asset (e.g., BTC).
Note, that we will add an extension to this model such that we account for the <em>expected</em> value from the perspective of the Vault for both assets.
However, for this simple model, the above should suffice.</p>
<p>As an aside, Vaults are liquidated before reaching 100% collateralization as defined by the <a class="reference internal" href="vault-registry.html#liquidationthreshold"><span class="std std-ref">LiquidationThreshold</span></a>.</p>
</section>
<section id="economic-security-with-vault-nomination">
<h4>Economic Security with Vault Nomination<a class="headerlink" href="#economic-security-with-vault-nomination" title="Permalink to this headline"></a></h4>
<p>Introducing Vault Nomination changes the effective collateralization rate at which Vaults have an economic incentive to steal BTC.</p>
<p>In both, the Vault First and Proportional Slashing, the effective collateralization rate at which Vaults should steal can be calculated by considering that if the value of <em>only</em> the Vault’s collateral is below 100% of the locked BTC, a Vault has an incentive to steal BTC.
We can then calculate the effective collateralization, under the assumption that a Vault is fully nominated, by taking the 100% collateralization provided by the Vault and adding the <a class="reference internal" href="#maxnominationratio"><span class="std std-ref">Max Nomination Ratio</span></a>:</p>
<div class="math notranslate nohighlight">
\[100\% + (100\% * \text{maxNominationRatio})\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If we take DOT as an example and use a secure collateral ratio of 150% and a premium redeem threshold of 135%, Vaults have an incentive to steal BTC if their collateralization falls below 125%.</p>
</div>
<p>Above the effective collateralization rate to steal BTC, the incentives to violate the security of the system (i.e., being under-collateralized <em>or</em> steal BTC), are different depending on the slashing strategy.</p>
<p><strong>Proportional Slashing</strong></p>
<p>For the under-collateralization failure, both Nominators and Vaults need to be active to (1) add more collateral to prevent such a failure, (2) reduce the amount of backed tokens, i.e., the number of backed interBTC, or (3) a combination of 1 and 2.
In this strategy each the Vault and its Nominators are punished proportionally to their collateral holdings.
We visualize this with the example below:</p>
<figure class="align-default" id="id12">
<span id="fig-proportional"></span><img alt="proportional-slashing" src="../_images/nomination_proportional_slashing.png" />
<figcaption>
<p><span class="caption-number">Fig. 19 </span><span class="caption-text">The slashed collateral (in %) in Proportional Slashing of a Vault and its Nominators.</span><a class="headerlink" href="#id12" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Assume the similar DOT example from above. Effective threshold when Vault has an incentive to steal Bitcoin: 100% + (100% * 25%) = 125% collateralization. In case of a liquidation, the Vault is slashed all collateral and the Nominators are slashed all collateral since we slash up to the secure collateral threshold.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is not recommended to use this strategy in case of Vault theft. If the Vault steals Bitcoin at collateralization of 187.5% (i.e., 150% + (150% * 25%)), the Vault’s and Nominators’ collateral are slashed proportionally such that 150%/187.5% = 80% of the collateral is slashed from both the Vault and its Nominators. Normally, the vault should not be motivated to steal but it might be the case if e.g., the DOT/BTC exchange rate drops, the exchange rate update is not yet reflected on chain, nominators are offline and cannot react, and the new exchange rate would bring the combined collateralization below 125% (such that Vault’s future collateral is below 100%)).</p>
</div>
<p><strong>Vault First Slashing</strong></p>
<p>Nominators cannot control if Vaults decide to steal BTC. While Nominators trust Vaults (see Security Assumption 1 and 2), the protocol still tries to minimize this case by slashing Vaults first in case of theft.
Therefore, in case of theft all of the Vaults available collateral are slashed before its Nominators.
At the lower bound of <span class="math notranslate nohighlight">\(100\% + (100\% * \text{maxNominationRatio})\)</span>, both Proportional Slashing and Vault First Slashing slash the same amount of collateral from a Vault and its Nominators. However, at higher collateralization rates, Vaults are comparatively more slashed.
See the figure below for an illustration using the threshold examples as above:</p>
<figure class="align-default" id="id13">
<span id="fig-vault-first"></span><img alt="vault-first-slashing" src="../_images/nomination_vault_first_slashing.png" />
<figcaption>
<p><span class="caption-number">Fig. 20 </span><span class="caption-text">The slashed collateral (in %) in Vault First Slashing of a Vault and its Nominators.</span><a class="headerlink" href="#id13" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Assume the similar DOT example from above. Effective threshold when Vault has an incentive to steal Bitcoin: 100% + (100% * 25%) = 125% collateralization. In case of theft, the vault is slashed all collateral, the nominators are slashed all collateral since we slash up to the secure collateral threshold. However, if the Vault steals Bitcoin at collateralization of 187.5% (i.e., 150% + (150% * 25%)), all of the vault’s collateral are slashed and none of the nominators collateral is slashed. Normally, the vault should not be motivated to steal but it might be the case if e.g., you modify my example from the comment above (exchange rate drops, not yet reflected on chain, nominators are offline and cannot react, new exchange rate would bring combined collaterealization below 125% (such that vault’s future collateral is below 100%)). In this case, the vault should steal BTC but in this case, we would only slash the vault for this.</p>
</div>
</section>
<section id="risk-summary">
<h4>Risk Summary<a class="headerlink" href="#risk-summary" title="Permalink to this headline"></a></h4>
<ol class="arabic simple">
<li><p><strong>Increased Exchange Rate Risk on Collateral Withdrawal</strong>: A Nominator may expose the Vault and the other Nominators to additional economic risk by withdrawing nominated collateral during an exchange rate spike. Similarly, the Vault may expose its Nominators to additional economic risk by withdrawing excess collateral.</p></li>
<li><p><strong>Vaults Have an Increased Incentive to Commit Theft</strong>: The effective collateralization rate at which Vault’s should steal Bitcoin increases from 100% to :math::<cite>100% + (100% * text{maxNominationRatio})</cite>.</p></li>
<li><p><strong>Different Slashing Strategies Reduce the Impact of Theft for Nominators</strong>: By applying Vault First Slashing, the impact of the slashed collateral for Nominators is reduced if the collateralization is <span class="math notranslate nohighlight">\(&gt; 100\% + (100\% * \text{maxNominationRatio})\)</span>.</p></li>
</ol>
</section>
</section>
</section>
<section id="data-model">
<h2>Data Model<a class="headerlink" href="#data-model" title="Permalink to this headline"></a></h2>
<section id="scalars">
<h3>Scalars<a class="headerlink" href="#scalars" title="Permalink to this headline"></a></h3>
<section id="nominationenabled">
<span id="id2"></span><h4>NominationEnabled<a class="headerlink" href="#nominationenabled" title="Permalink to this headline"></a></h4>
<p>Flag indicating whether this feature is enabled.</p>
<ul class="simple">
<li><p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, Vaults MAY opt-in to be nominated.</p></li>
<li><p>If set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, Vaults MUST NOT be able to opt-in to nomination. Already nominated Vaults MUST keep being nominated as Vaults may have issued <cite>interBTC</cite> with nominated collateral when this feature was enabled.</p></li>
</ul>
</section>
</section>
<section id="maps">
<h3>Maps<a class="headerlink" href="#maps" title="Permalink to this headline"></a></h3>
<section id="vaults">
<h4>Vaults<a class="headerlink" href="#vaults" title="Permalink to this headline"></a></h4>
<p>Set of Vault accounts that have enabled nomination.</p>
</section>
</section>
<section id="structs">
<h3>Structs<a class="headerlink" href="#structs" title="Permalink to this headline"></a></h3>
</section>
</section>
<section id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline"></a></h2>
<section id="setnominationenabled">
<span id="id3"></span><h3>setNominationEnabled<a class="headerlink" href="#setnominationenabled" title="Permalink to this headline"></a></h3>
<p>Set the feature flag for Vault nomination.</p>
<section id="specification">
<h4>Specification<a class="headerlink" href="#specification" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">setNominationEnabled(enabled)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enabled</span></code>: <code class="docutils literal notranslate"><span class="pre">True</span></code> if nomination should be enabled, <code class="docutils literal notranslate"><span class="pre">False</span></code> if it should be disabled.</p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The calling account MUST be root (system level origin).</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">NominationEnabled</span></code> scalar MUST be set to the value of the <code class="docutils literal notranslate"><span class="pre">enabled</span></code> parameter.</p></li>
</ul>
</section>
</section>
<section id="optintonomination">
<span id="id4"></span><h3>optInToNomination<a class="headerlink" href="#optintonomination" title="Permalink to this headline"></a></h3>
<p>Allow the Vault to receive nominated collateral.</p>
<section id="id5">
<h4>Specification<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">optInToNomination(vaultId)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: the id of the Vault to enable nomination for.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#nominationoptinevent"><span class="std std-ref">NominationOptIn</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST be <code class="docutils literal notranslate"><span class="pre">RUNNING:0</span></code>.</p></li>
<li><p><a class="reference internal" href="#nominationenabled"><span class="std std-ref">NominationEnabled</span></a> MUST be true.</p></li>
<li><p>A Vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
<li><p>The Vault MUST NOT be opted in.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>The Vault MUST be allowed to receive nominated collateral.</p></li>
</ul>
</section>
</section>
<section id="optoutofnomination">
<span id="id6"></span><h3>optOutOfNomination<a class="headerlink" href="#optoutofnomination" title="Permalink to this headline"></a></h3>
<p>Disallow the Vault from receiving nominated collateral and force refund Nominators.</p>
<section id="id7">
<h4>Specification<a class="headerlink" href="#id7" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">optOutOfNomination(vaultId)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: the id of the Vault to deregister from the nomination feature.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#nominationoptoutevent"><span class="std std-ref">NominationOptOut</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST be <code class="docutils literal notranslate"><span class="pre">RUNNING:0</span></code>.</p></li>
<li><p>A Vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
<li><p>A Vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST exist in the <code class="docutils literal notranslate"><span class="pre">Vaults</span></code> mapping.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>The Vault MUST be removed from the <code class="docutils literal notranslate"><span class="pre">Vaults</span></code> mapping.</p></li>
<li><p>The Vault MUST remain above the secure collateralization threshold.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getTotalNominatedCollateral(vaultId)</span></code> must return zero.</p></li>
<li><p>For all nominators, <code class="docutils literal notranslate"><span class="pre">getNominatorCollateral(vaultId,</span> <span class="pre">userId)</span></code> must return zero.</p></li>
<li><p>Staking pallet <code class="docutils literal notranslate"><span class="pre">nonce</span></code> must be incremented by one.</p></li>
<li><p>The return value of calling <a class="reference internal" href="staking.html#staking-computerewardatindex"><span class="std std-ref">computeRewardAtIndex</span></a> parameterized with <code class="docutils literal notranslate"><span class="pre">(nonce</span> <span class="pre">-</span> <span class="pre">1,</span> <span class="pre">INTERBTC,</span> <span class="pre">vaultId,</span> <span class="pre">userId)</span></code> must be equal to the user’s nomination just before the vault opted out.</p></li>
</ul>
</section>
</section>
<section id="depositcollateral">
<span id="depositnominationcollateral"></span><h3>depositCollateral<a class="headerlink" href="#depositcollateral" title="Permalink to this headline"></a></h3>
<p>Nominate collateral to a selected Vault.</p>
<section id="id8">
<h4>Specification<a class="headerlink" href="#id8" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">depositCollateral(vaultId,</span> <span class="pre">nominatorId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: the id of the Vault to receive the nomination.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nominatorId</span></code>: the id of the user nominating collateral.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amount</span></code>: the amount of collateral to nominate.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#depositnominationcollateralevent"><span class="std std-ref">DepositCollateral</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST be <code class="docutils literal notranslate"><span class="pre">RUNNING:0</span></code>.</p></li>
<li><p><a class="reference internal" href="#nominationenabled"><span class="std std-ref">NominationEnabled</span></a> MUST be true.</p></li>
<li><p>A Vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
<li><p>A Vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST exist in the <code class="docutils literal notranslate"><span class="pre">Vaults</span></code> mapping.</p></li>
<li><p>The nominator’s free balance in the vault’s used currency MUST be at least <cite>amount</cite>.</p></li>
<li><p>The Vault MUST remain below the max nomination ratio.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>The Vault’s backing collateral MUST increase by the amount nominated.</p></li>
<li><p>The Nominator’s balance in the vault’s <code class="docutils literal notranslate"><span class="pre">currencyId</span></code> MUST decrease by the amount nominated.</p></li>
</ul>
</section>
</section>
<section id="withdrawcollateral">
<span id="withdrawnominationcollateral"></span><h3>withdrawCollateral<a class="headerlink" href="#withdrawcollateral" title="Permalink to this headline"></a></h3>
<p>Withdraw collateral from a nominated Vault.</p>
<section id="id9">
<h4>Specification<a class="headerlink" href="#id9" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">withdrawCollateral(vaultId,</span> <span class="pre">nominatorId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: the id of the previously nominated Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nominatorId</span></code>: the id of the user who nominated collateral.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amount</span></code>: the amount of collateral to withdraw.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#withdrawnominationcollateralevent"><span class="std std-ref">WithdrawCollateral</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST be <code class="docutils literal notranslate"><span class="pre">RUNNING:0</span></code>.</p></li>
<li><p><a class="reference internal" href="#nominationenabled"><span class="std std-ref">NominationEnabled</span></a> MUST be true.</p></li>
<li><p>A Vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
<li><p>A Vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST exist in the <code class="docutils literal notranslate"><span class="pre">Vaults</span></code> mapping.</p></li>
<li><p>The Vault MUST remain above the secure collateralization threshold.</p></li>
<li><p>Nominator MUST have a nomination with the given vault (including slashes) of at least <code class="docutils literal notranslate"><span class="pre">amount</span></code>.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>The Vault’s collateral MUST decrease by <code class="docutils literal notranslate"><span class="pre">amount</span></code>.</p></li>
<li><p>The Nominator’s balance in the vault’s <code class="docutils literal notranslate"><span class="pre">currencyId</span></code> MUST increase by <code class="docutils literal notranslate"><span class="pre">amount</span></code>.</p></li>
</ul>
</section>
</section>
</section>
<section id="events">
<h2>Events<a class="headerlink" href="#events" title="Permalink to this headline"></a></h2>
<section id="nominationoptin">
<span id="nominationoptinevent"></span><h3>NominationOptIn<a class="headerlink" href="#nominationoptin" title="Permalink to this headline"></a></h3>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">NominationOptIn(vaultId)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: the id of the Vault who opted in.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#optintonomination"><span class="std std-ref">optInToNomination</span></a></p></li>
</ul>
</section>
<section id="nominationoptout">
<span id="nominationoptoutevent"></span><h3>NominationOptOut<a class="headerlink" href="#nominationoptout" title="Permalink to this headline"></a></h3>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">NominationOptOut(vaultId)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: the id of the Vault who opted out.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#optoutofnomination"><span class="std std-ref">optOutOfNomination</span></a></p></li>
</ul>
</section>
<section id="depositnominationcollateralevent">
<span id="id10"></span><h3>DepositCollateral<a class="headerlink" href="#depositnominationcollateralevent" title="Permalink to this headline"></a></h3>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">DepositCollateral(vaultId,</span> <span class="pre">nominatorId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: the id of the Vault who receives the nomination.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nominatorId</span></code>: the id of the nominator who is depositing collateral.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amount</span></code>: the amount of nominated collateral.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#depositnominationcollateral"><span class="std std-ref">depositCollateral</span></a></p></li>
</ul>
</section>
<section id="withdrawnominationcollateralevent">
<span id="id11"></span><h3>WithdrawCollateral<a class="headerlink" href="#withdrawnominationcollateralevent" title="Permalink to this headline"></a></h3>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">WithdrawCollateral(vaultId,</span> <span class="pre">nominatorId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: the id of the previously nominated Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nominatorId</span></code>: the id of the nominator who is withdrawing collateral.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amount</span></code>: the amount of nominated collateral.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#withdrawnominationcollateral"><span class="std std-ref">withdrawCollateral</span></a></p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="vault-registry.html" class="btn btn-neutral float-left" title="Vault Registry" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="reward.html" class="btn btn-neutral float-right" title="Reward" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Interlay.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>