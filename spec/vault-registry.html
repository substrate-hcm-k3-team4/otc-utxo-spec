<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vault Registry &mdash; interBTC Specification  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Vault Nomination" href="nomination.html" />
    <link rel="prev" title="Treasury" href="treasury.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: grey" >
            <a href="../index.html" class="icon icon-home"> interBTC Specification
          </a>
              <div class="version">
                v5.6.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/at-a-glance.html">interBTC at a Glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/CbA.html">Cryptocurrency-backed Assets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/polkadot.html">Polkadot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/bitcoin.html">Bitcoin Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/accepted-format.html">Accepted Bitcoin Transaction Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">How to Read This Specification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Specification</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="btc-relay/index.html">BTC-Relay</a></li>
<li class="toctree-l1"><a class="reference internal" href="collateral.html">Collateral</a></li>
<li class="toctree-l1"><a class="reference internal" href="currency.html">Currency</a></li>
<li class="toctree-l1"><a class="reference internal" href="fee.html">Fee</a></li>
<li class="toctree-l1"><a class="reference internal" href="oracle.html">Oracle</a></li>
<li class="toctree-l1"><a class="reference internal" href="issue.html">Issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="refund.html">Refund</a></li>
<li class="toctree-l1"><a class="reference internal" href="redeem.html">Redeem</a></li>
<li class="toctree-l1"><a class="reference internal" href="replace.html">Replace</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="relay.html">Relay</a></li>
<li class="toctree-l1"><a class="reference internal" href="treasury.html">Treasury</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Vault Registry</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#multi-collateral">Multi-Collateral</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#data-model">Data Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scalars">Scalars</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#punishmentdelay">PunishmentDelay</a></li>
<li class="toctree-l4"><a class="reference internal" href="#liquidationvaultaccountid">LiquidationVaultAccountId</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#maps">Maps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#liquidationvault">LiquidationVault</a></li>
<li class="toctree-l4"><a class="reference internal" href="#minimumcollateralvault">MinimumCollateralVault</a></li>
<li class="toctree-l4"><a class="reference internal" href="#securecollateralthreshold">SecureCollateralThreshold</a></li>
<li class="toctree-l4"><a class="reference internal" href="#premiumredeemthreshold">PremiumRedeemThreshold</a></li>
<li class="toctree-l4"><a class="reference internal" href="#liquidationthreshold">LiquidationThreshold</a></li>
<li class="toctree-l4"><a class="reference internal" href="#systemcollateralceiling">SystemCollateralCeiling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vaults">Vaults</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#structs">Structs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#vault">Vault</a></li>
<li class="toctree-l4"><a class="reference internal" href="#systemvault">SystemVault</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#external-functions">External Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#register-vault">register_vault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#specification">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#registeraddress">registerAddress</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id9">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#updatepublickey">updatePublicKey</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id11">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#deposit-collateral">deposit_collateral</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id12">Specification</a></li>
<li class="toctree-l4"><a class="reference internal" href="#precondition">Precondition</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#withdrawcollateral">withdrawCollateral</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id14">Specification</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#internal-functions">Internal Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tryincreasetobeissuedtokens">tryIncreaseToBeIssuedTokens</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id16">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#decreasetobeissuedtokens">decreaseToBeIssuedTokens</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id18">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#issuetokens">issueTokens</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id20">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tryincreasetoberedeemedtokens">tryIncreaseToBeRedeemedTokens</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id22">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#decreasetoberedeemedtokens">decreaseToBeRedeemedTokens</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id24">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#decreasetokens">decreaseTokens</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id26">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#redeemtokens">redeemTokens</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id28">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#redeemtokensliquidation">redeemTokensLiquidation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id30">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#increasetobereplacedtokens">increaseToBeReplacedTokens</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id32">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#decreasetobereplacedtokens">decreaseToBeReplacedTokens</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id34">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#replacetokens">replaceTokens</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id36">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cancelreplacetokens">cancelReplaceTokens</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id38">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#liquidatevault">liquidateVault</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id40">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#getmaxnominationratio">getMaxNominationRatio</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#events">Events</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#registervault">RegisterVault</a></li>
<li class="toctree-l3"><a class="reference internal" href="#depositcollateral">DepositCollateral</a></li>
<li class="toctree-l3"><a class="reference internal" href="#withdrawcollateralevent">WithdrawCollateral</a></li>
<li class="toctree-l3"><a class="reference internal" href="#registeraddressevent">RegisterAddress</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updatepublickeyevent">UpdatePublicKey</a></li>
<li class="toctree-l3"><a class="reference internal" href="#increasetobeissuedtokens">IncreaseToBeIssuedTokens</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decreasetobeissuedtokensevent">DecreaseToBeIssuedTokens</a></li>
<li class="toctree-l3"><a class="reference internal" href="#issuetokensevent">IssueTokens</a></li>
<li class="toctree-l3"><a class="reference internal" href="#increasetoberedeemedtokens">IncreaseToBeRedeemedTokens</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decreasetoberedeemedtokensevent">DecreaseToBeRedeemedTokens</a></li>
<li class="toctree-l3"><a class="reference internal" href="#increasetobereplacedtokensevent">IncreaseToBeReplacedTokens</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decreasetobereplacedtokensevent">DecreaseToBeReplacedTokens</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decreasetokensevent">DecreaseTokens</a></li>
<li class="toctree-l3"><a class="reference internal" href="#redeemtokensevent">RedeemTokens</a></li>
<li class="toctree-l3"><a class="reference internal" href="#redeemtokenspremium">RedeemTokensPremium</a></li>
<li class="toctree-l3"><a class="reference internal" href="#redeemtokensliquidationevent">RedeemTokensLiquidation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#redeemtokensliquidatedvault">RedeemTokensLiquidatedVault</a></li>
<li class="toctree-l3"><a class="reference internal" href="#replacetokensevent">ReplaceTokens</a></li>
<li class="toctree-l3"><a class="reference internal" href="#liquidatevaultevent">LiquidateVault</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#error-codes">Error Codes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="nomination.html">Vault Nomination</a></li>
<li class="toctree-l1"><a class="reference internal" href="reward.html">Reward</a></li>
<li class="toctree-l1"><a class="reference internal" href="staking.html">Staking</a></li>
<li class="toctree-l1"><a class="reference internal" href="escrow.html">Escrow</a></li>
<li class="toctree-l1"><a class="reference internal" href="governance.html">Governance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Security and Performance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/liquidations.html">Vault Liquidations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/xclaim-security.html">XCLAIM Security Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/btcrelay-security.html">BTC-Relay Security Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/performance.html">Performance Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Economics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../economics/incentives.html">Economic Incentives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../economics/fees.html">Fee Model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">All the rest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../other/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../other/interlay.html">Interlay</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: grey" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">interBTC Specification</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Vault Registry</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/spec/vault-registry.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="vault-registry">
<span id="id1"></span><h1>Vault Registry<a class="headerlink" href="#vault-registry" title="Permalink to this headline"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>The vault registry is the central place to manage vaults. Vaults can register themselves here, update their collateral, or can be liquidated.
Similarly, the issue, redeem, refund, and replace protocols call this module to assign vaults during issue, redeem, refund, and replace procedures.
Moreover, vaults use the registry to register public key for the <a class="reference internal" href="../security_performance/xclaim-security.html#okd"><span class="std std-ref">On-Chain Key Derivation Scheme</span></a> and register addresses for the <a class="reference internal" href="../security_performance/xclaim-security.html#op-return"><span class="std std-ref">OP_RETURN</span></a> scheme.</p>
<section id="multi-collateral">
<span id="vault-registry-overview-multi-collateral"></span><h3>Multi-Collateral<a class="headerlink" href="#multi-collateral" title="Permalink to this headline"></a></h3>
<p>The parachain supports the usage of different currencies for usage as collateral. Which currencies are allowed is determined by governance - they have to explicitly white-list currencies to be able to be used as collateral. They also have to set the various safety thresholds for each currency.</p>
<p>Vaults in the system are identified by a VaultId, which is essentially a (AccountId, CollateralCurrency, WrappedCurrency) tuple. Note the distinction between the AccountId and the VaultId. A vault operator can run multiple vaults using a the same AccountId but different collateral currencies (and thus VaultIds). Each vault is isolated from all others. This means that if vault operator has two running vaults using the same AccountId but different CollateralCurrencies, then if one of the vaults were to get liquidated, the other vaults remains untouched. The vault client manages all VaultIds associated with a given AccountId. Vault operators will be able to register new VaultIds through the UI, and the vault client will automatically start to manage these.</p>
<p>When a user requests an issue, it selects a single vault to issue with (this choice may be made automatically by the UI). However, since the wrapped token is fully fungible, it may be redeemed with any vault, even if that vault is using a different collateral currency. When redeeming, the user again selects a single vault to redeem with. If a vault fails to execute a redeem request, the user is able to either get back its wrapped token, or to get reimbursed in the vault’s collateral currency. If the user prefers the latter, the choice of vault becomes relevant because it determines which currency is received in case of failure.</p>
<p>The WrappedCurrency part of the VaultId is currently always required to take the same value - in the future support for different wrapped currencies may be added.</p>
<p>Moreover, the system implements a ceiling for the maximum amount of collateral than can be locked in the system per collateral and wrapped token pair. Governance is able to update the collateral ceilings.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please note that multi-collateral is a recent addition to the code, and the spec has not been fully updated .</p>
</div>
</section>
</section>
<section id="data-model">
<h2>Data Model<a class="headerlink" href="#data-model" title="Permalink to this headline"></a></h2>
<section id="scalars">
<h3>Scalars<a class="headerlink" href="#scalars" title="Permalink to this headline"></a></h3>
<section id="punishmentdelay">
<span id="id2"></span><h4>PunishmentDelay<a class="headerlink" href="#punishmentdelay" title="Permalink to this headline"></a></h4>
<p>Time period in which a Vault cannot participate in issue, redeem or replace requests.</p>
<ul class="simple">
<li><p>Measured in Parachain blocks</p></li>
<li><p>Initial value: 1 day (Parachain constant)</p></li>
</ul>
</section>
<section id="liquidationvaultaccountid">
<h4>LiquidationVaultAccountId<a class="headerlink" href="#liquidationvaultaccountid" title="Permalink to this headline"></a></h4>
<p>Account identifier of an artificial vault maintained by the VaultRegistry to handle interBTC balances and DOT collateral of liquidated Vaults. That is, when a vault is liquidated, its balances are transferred to <code class="docutils literal notranslate"><span class="pre">LiquidationVaultAccountId</span></code> and claims are later handled via the <code class="docutils literal notranslate"><span class="pre">LiquidationVault</span></code>.</p>
</section>
</section>
<section id="maps">
<h3>Maps<a class="headerlink" href="#maps" title="Permalink to this headline"></a></h3>
<section id="liquidationvault">
<span id="id3"></span><h4>LiquidationVault<a class="headerlink" href="#liquidationvault" title="Permalink to this headline"></a></h4>
<p>Mapping from <code class="docutils literal notranslate"><span class="pre">CurrencyId</span></code> to the account identifier of an artificial vault (see <a class="reference internal" href="#systemvault"><span class="std std-ref">SystemVault</span></a>) maintained by the VaultRegistry to handle interBTC balances and collateral of liquidated Vaults that use the given currency. That is, when a vault is liquidated, its balances are transferred to <code class="docutils literal notranslate"><span class="pre">LiquidationVault</span></code> and claims are later handled via the <code class="docutils literal notranslate"><span class="pre">LiquidationVault</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A Vault’s token balances and collateral are transferred to the <code class="docutils literal notranslate"><span class="pre">LiquidationVault</span></code> as a result of automated liquidations and <a class="reference internal" href="relay.html#relay-function-report-vault-theft"><span class="std std-ref">report_vault_theft</span></a>.</p>
</div>
</section>
<section id="minimumcollateralvault">
<h4>MinimumCollateralVault<a class="headerlink" href="#minimumcollateralvault" title="Permalink to this headline"></a></h4>
<p>Mapping from <code class="docutils literal notranslate"><span class="pre">CurrencyId</span></code> to the minimum collateral a vault needs to provide to register.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is a protection against spamming the protocol with very small collateral amounts. Vaults are still able to withdraw the collateral after registration, but at least it requires an additional transaction fee, and it provides protection against accidental registration with very low amounts of collateral.</p>
</div>
</section>
<section id="securecollateralthreshold">
<span id="id4"></span><h4>SecureCollateralThreshold<a class="headerlink" href="#securecollateralthreshold" title="Permalink to this headline"></a></h4>
<p>Mapping from <code class="docutils literal notranslate"><span class="pre">CurrencyId</span></code> to to the over-collateralization rate for collateral locked by Vaults, necessary for issuing tokens.</p>
<p>The Vault can take on issue requests depending on the collateral it provides and under consideration of the <code class="docutils literal notranslate"><span class="pre">SecureCollateralThreshold</span></code>.
The maximum amount of interBTC a vault is able to support during the issue process is based on the following equation:</p>
<p><span class="math notranslate nohighlight">\(\text{max(interBTC)} = \text{collateral} * \text{ExchangeRate} / \text{SecureCollateralThreshold}\)</span>.</p>
<ul class="simple">
<li><p>The Secure Collateral Threshold MUST be greater than the Liquidation Threshold.</p></li>
<li><p>The Secure Collateral Threshold MUST be greater than the Premium Redeem Threshold.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As an example, assume we use <code class="docutils literal notranslate"><span class="pre">DOT</span></code> as collateral, we issue <code class="docutils literal notranslate"><span class="pre">interBTC</span></code> and lock <code class="docutils literal notranslate"><span class="pre">BTC</span></code> on the Bitcoin side. Let’s assume the <code class="docutils literal notranslate"><span class="pre">BTC</span></code>/<code class="docutils literal notranslate"><span class="pre">DOT</span></code> exchange rate is <code class="docutils literal notranslate"><span class="pre">80</span></code>, i.e., one has to pay 80 <code class="docutils literal notranslate"><span class="pre">DOT</span></code> to receive 1 <code class="docutils literal notranslate"><span class="pre">BTC</span></code>. Further, the <code class="docutils literal notranslate"><span class="pre">SecureCollateralThreshold</span></code> is 200%, i.e., a vault has to provide two-times the amount of collateral to back an issue request. Now let’s say the vault deposits 400 <code class="docutils literal notranslate"><span class="pre">DOT</span></code> as collateral. Then this vault can back at most 2.5 interBTC as: <span class="math notranslate nohighlight">\(400 * (1/80) / 2 = 2.5\)</span>.</p>
</div>
</section>
<section id="premiumredeemthreshold">
<span id="premiumcollateralthreshold"></span><h4>PremiumRedeemThreshold<a class="headerlink" href="#premiumredeemthreshold" title="Permalink to this headline"></a></h4>
<p>Mapping from <code class="docutils literal notranslate"><span class="pre">CurrencyId</span></code> to the the collateral rate of Vaults, at which users receive a premium, allocated from the Vault’s collateral, when performing a <a class="reference internal" href="redeem.html#redeem-protocol"><span class="std std-ref">Redeem</span></a> with this Vault.</p>
<ul class="simple">
<li><p>The Premium Redeem Threshold MUST be greater than the Liquidation Threshold.</p></li>
</ul>
</section>
<section id="liquidationthreshold">
<span id="id5"></span><h4>LiquidationThreshold<a class="headerlink" href="#liquidationthreshold" title="Permalink to this headline"></a></h4>
<p>Mapping from <code class="docutils literal notranslate"><span class="pre">CurrencyId</span></code> to the lower bound for the collateral rate in issued tokens. If a Vault’s collateral rate drops below this, automatic liquidation is triggered.</p>
<ul class="simple">
<li><p>The Liquidation Threshold MUST be greater than 100% for any collateral asset.</p></li>
</ul>
</section>
<section id="systemcollateralceiling">
<span id="vault-registry-map-system-collateral-ceiling"></span><h4>SystemCollateralCeiling<a class="headerlink" href="#systemcollateralceiling" title="Permalink to this headline"></a></h4>
<p>Mapping from a collateral <code class="docutils literal notranslate"><span class="pre">CurrencyId</span></code> to a wrapped <code class="docutils literal notranslate"><span class="pre">CurrencyId</span></code>. Determines the maximum amount of collateral that Vaults are able to lock for backing a wrapped asset.</p>
</section>
<section id="vaults">
<span id="id6"></span><h4>Vaults<a class="headerlink" href="#vaults" title="Permalink to this headline"></a></h4>
<p>Mapping from accounts of Vaults to their struct. <code class="docutils literal notranslate"><span class="pre">&lt;Account,</span> <span class="pre">Vault&gt;</span></code>.</p>
</section>
</section>
<section id="structs">
<h3>Structs<a class="headerlink" href="#structs" title="Permalink to this headline"></a></h3>
<section id="vault">
<h4>Vault<a class="headerlink" href="#vault" title="Permalink to this headline"></a></h4>
<p>Stores the information of a Vault.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 12%" />
<col style="width: 8%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">wallet</span></code></p></td>
<td><p>Wallet&lt;BtcAddress&gt;</p></td>
<td><p>A set of Bitcoin address(es) of this vault, used for theft detection. Additionally, it contains the btcPublicKey used for generating deposit addresses in the issue process.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">status</span></code></p></td>
<td><p>VaultStatus</p></td>
<td><p>Current status of the vault (Active, Liquidated, CommittedTheft)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bannedUntil</span></code></p></td>
<td><p>BlockNumber</p></td>
<td><p>Block height until which this vault is banned from being used for Issue, Redeem (except during automatic liquidation) and Replace .</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code></p></td>
<td><p>interBTC</p></td>
<td><p>Number of interBTC tokens currently requested as part of an uncompleted issue request.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code></p></td>
<td><p>interBTC</p></td>
<td><p>Number of interBTC tokens actively issued by this Vault.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code></p></td>
<td><p>interBTC</p></td>
<td><p>Number of interBTC tokens reserved by pending redeem and replace requests.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">toBeReplacedTokens</span></code></p></td>
<td><p>interBTC</p></td>
<td><p>Number of interBTC tokens requested for replacement.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">replaceCollateral</span></code></p></td>
<td><p>DOT</p></td>
<td><p>Griefing collateral to be used for accepted replace requests.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">liquidatedCollateral</span></code></p></td>
<td><p>DOT</p></td>
<td><p>Any collateral that is locked for remaining to_be_redeemed on liquidation.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code></p></td>
<td><p>CurrencyId</p></td>
<td><p>The currency the vault uses for collateral</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This specification currently assumes for simplicity that a vault will reuse the same BTC address, even after multiple redeem requests. <strong>[Future Extension]</strong>: For better security, Vaults may desire to generate new BTC addresses each time they execute a redeem request. This can be handled by pre-generating multiple BTC addresses and storing these in a list for each Vault. Caution is necessary for users which execute issue requests with “old” vault addresses - these BTC must be moved to the latest address by Vaults.</p>
</div>
</section>
<section id="systemvault">
<span id="id7"></span><h4>SystemVault<a class="headerlink" href="#systemvault" title="Permalink to this headline"></a></h4>
<p>A system vault that keeps track of tokens of liquidated vaults.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 18%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">toBeIssuedtokens</span></code></p></td>
<td><p>interBTC</p></td>
<td><p>Number of tokens pending issue</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code></p></td>
<td><p>interBTC</p></td>
<td><p>Number of issued tokens</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code></p></td>
<td><p>interBTC</p></td>
<td><p>Number of tokens pending redeem</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code></p></td>
<td><p>CurrencyId</p></td>
<td><p>the currency used for collateral</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="external-functions">
<h2>External Functions<a class="headerlink" href="#external-functions" title="Permalink to this headline"></a></h2>
<section id="register-vault">
<span id="vault-registry-function-register-vault"></span><h3>register_vault<a class="headerlink" href="#register-vault" title="Permalink to this headline"></a></h3>
<p>Registers a new Vault. The vault locks up some amount of collateral, and provides a public key which is used for the <a class="reference internal" href="../security_performance/xclaim-security.html#okd"><span class="std std-ref">On-Chain Key Derivation Scheme</span></a>.</p>
<section id="specification">
<h4>Specification<a class="headerlink" href="#specification" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">register_vault(vault,</span> <span class="pre">collateral,</span> <span class="pre">btcPublicKey)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: The account of the vault to be registered.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">collateral</span></code>: to-be-locked collateral.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">btcPublicKey</span></code>: public key used to derive deposit keys with the <a class="reference internal" href="../security_performance/xclaim-security.html#okd"><span class="std std-ref">On-Chain Key Derivation Scheme</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: the currency that the vault will use as collateral.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#registervaultevent"><span class="std std-ref">RegisterVault</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The function call MUST be signed by <code class="docutils literal notranslate"><span class="pre">vaultId</span></code>.</p></li>
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST NOT be <code class="docutils literal notranslate"><span class="pre">SHUTDOWN:2</span></code>.</p></li>
<li><p>The vault MUST NOT be registered yet</p></li>
<li><p>The vault MUST have sufficient funds to lock the collateral</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">collateral</span> <span class="pre">&gt;</span> <span class="pre">MinimumCollateralVault</span></code>, i.e., the vault MUST provide sufficient collateral (above the spam protection threshold).</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul>
<li><p>The vault’s free balance in the given currency MUST decrease by <code class="docutils literal notranslate"><span class="pre">collateral</span></code>.</p></li>
<li><p>The vault’s reserved balance MUST in the given currency increase by <code class="docutils literal notranslate"><span class="pre">collateral</span></code>.</p></li>
<li><p>The new vault MUST be created as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault.wallet</span></code>: MUST be empty.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vault.status</span></code>: MUST be set to <code class="docutils literal notranslate"><span class="pre">active=true</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vault.bannedUntil</span></code>: MUST be empty.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vault.toBeIssuedTokens</span></code>: MUST be zero.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vault.issuedTokens</span></code>: MUST be zero.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vault.toBeRedeemedTokens</span></code>: MUST be zero.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vault.toBeReplacedTokens</span></code>: MUST be zero.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vault.replaceCollateral</span></code>: MUST be zero.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vault.liquidatedCollateral</span></code>: MUST be zero.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vault.currencyId</span></code>: MUST be the supplied <code class="docutils literal notranslate"><span class="pre">currencyId</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>The new vault MUST be inserted into <a class="reference internal" href="#vaults"><span class="std std-ref">Vaults</span></a> using their account identifier as key.</p></li>
</ul>
</section>
</section>
<section id="registeraddress">
<span id="id8"></span><h3>registerAddress<a class="headerlink" href="#registeraddress" title="Permalink to this headline"></a></h3>
<p>Add a new BTC address to the vault’s wallet. Typically this function is called by the vault client to register a return-to-self address, prior to making redeem/replace payments. If a vault makes a payment to an address that is not registered, nor is a valid redeem/replace payment, it will be marked as theft.</p>
<section id="id9">
<h4>Specification<a class="headerlink" href="#id9" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">registerAddress(vaultId,</span> <span class="pre">address)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: the account of the vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">address</span></code>: a valid BTC address.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#registeraddressevent"><span class="std std-ref">RegisterAddress</span></a></p></li>
</ul>
<p>Precondition</p>
<ul class="simple">
<li><p>The function call MUST be signed by <code class="docutils literal notranslate"><span class="pre">vaultId</span></code>.</p></li>
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST NOT be set to <code class="docutils literal notranslate"><span class="pre">SHUTDOWN:</span> <span class="pre">2</span></code>.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST NOT be registered.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">address</span></code> MUST be added to the vault’s wallet.</p></li>
</ul>
</section>
</section>
<section id="updatepublickey">
<span id="id10"></span><h3>updatePublicKey<a class="headerlink" href="#updatepublickey" title="Permalink to this headline"></a></h3>
<p>Changes a vault’s public key that is used for the <a class="reference internal" href="../security_performance/xclaim-security.html#okd"><span class="std std-ref">On-Chain Key Derivation Scheme</span></a>.</p>
<section id="id11">
<h4>Specification<a class="headerlink" href="#id11" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">updatePublicKey(vaultId,</span> <span class="pre">publicKey)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: the account of the vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">publicKey</span></code>: the new BTC public key of the vault.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#updatepublickeyevent"><span class="std std-ref">UpdatePublicKey</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The function call MUST be signed by <code class="docutils literal notranslate"><span class="pre">vaultId</span></code>.</p></li>
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST NOT be set to <code class="docutils literal notranslate"><span class="pre">SHUTDOWN:</span> <span class="pre">2</span></code>.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>The vault’s public key MUST be set to <code class="docutils literal notranslate"><span class="pre">publicKey</span></code>.</p></li>
</ul>
</section>
</section>
<section id="deposit-collateral">
<span id="vault-registry-function-deposit-collateral"></span><h3>deposit_collateral<a class="headerlink" href="#deposit-collateral" title="Permalink to this headline"></a></h3>
<p>The vault locks additional collateral as a security against stealing the Bitcoin locked with it.</p>
<section id="id12">
<h4>Specification<a class="headerlink" href="#id12" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">deposit_collateral(vaultId,</span> <span class="pre">collateral)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: The account of the vault locking collateral.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">collateral</span></code>: to-be-locked collateral.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#depositcollateralevent"><span class="std std-ref">DepositCollateral</span></a></p></li>
</ul>
</section>
<section id="precondition">
<h4>Precondition<a class="headerlink" href="#precondition" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p>The function call MUST be signed by <code class="docutils literal notranslate"><span class="pre">vaultId</span></code>.</p></li>
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST NOT be set to <code class="docutils literal notranslate"><span class="pre">SHUTDOWN:</span> <span class="pre">2</span></code>.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
<li><p>The vault MUST have sufficient unlocked collateral in the currency determined by <code class="docutils literal notranslate"><span class="pre">vault.currencyId</span></code> to lock.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>Function <a class="reference internal" href="staking.html#staking-depositstake"><span class="std std-ref">depositStake</span></a> MUST complete successfully - parameterized by <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> and <code class="docutils literal notranslate"><span class="pre">collateral</span></code>.</p></li>
<li><p>The vault MUST lock an amount of <code class="docutils literal notranslate"><span class="pre">collateral</span></code> of its collateral, using the currency set in <code class="docutils literal notranslate"><span class="pre">vault.currencyId</span></code>.</p></li>
</ul>
</section>
</section>
<section id="withdrawcollateral">
<span id="id13"></span><h3>withdrawCollateral<a class="headerlink" href="#withdrawcollateral" title="Permalink to this headline"></a></h3>
<p>A vault can withdraw its <em>free</em> collateral at any time, as long as the collateralization ratio remains above the <code class="docutils literal notranslate"><span class="pre">SecureCollateralThreshold</span></code>. Collateral that is currently being used to back issued interBTC remains locked until the vault is used for a redeem request (full release can take multiple redeem requests).</p>
<section id="id14">
<h4>Specification<a class="headerlink" href="#id14" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">withdrawCollateral(vaultId,</span> <span class="pre">withdrawAmount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: The account of the vault withdrawing collateral.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">withdrawAmount</span></code>: To-be-withdrawn collateral.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#withdrawcollateralevent"><span class="std std-ref">WithdrawCollateral</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The function call MUST be signed by <code class="docutils literal notranslate"><span class="pre">vaultId</span></code>.</p></li>
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST be set to <code class="docutils literal notranslate"><span class="pre">RUNNING:0</span></code>.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
<li><p>The collatalization rate of the vault MUST remain above <code class="docutils literal notranslate"><span class="pre">SecureCollateralThreshold</span></code> after the withdrawal of <code class="docutils literal notranslate"><span class="pre">withdrawAmount</span></code>.</p></li>
<li><p>After the withdrawal, the vault’s ratio of nominated collateral to own collateral must remain above the value returned by <a class="reference internal" href="#getmaxnominationratio"><span class="std std-ref">getMaxNominationRatio</span></a>.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>Function <a class="reference internal" href="staking.html#staking-withdrawstake"><span class="std std-ref">withdrawStake</span></a> MUST complete successfully - parameterized by <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> and <code class="docutils literal notranslate"><span class="pre">withdrawAmount</span></code>.</p></li>
<li><p>The vault’s free balance in the currency configured by <code class="docutils literal notranslate"><span class="pre">vault.currencyID</span></code> MUST increase by <code class="docutils literal notranslate"><span class="pre">withdrawAmount</span></code>.</p></li>
<li><p>The vault’s locked balance in the currency configured by <code class="docutils literal notranslate"><span class="pre">vault.currencyID</span></code> MUST decrease by <code class="docutils literal notranslate"><span class="pre">withdrawAmount</span></code>.</p></li>
</ul>
</section>
</section>
</section>
<section id="internal-functions">
<h2>Internal Functions<a class="headerlink" href="#internal-functions" title="Permalink to this headline"></a></h2>
<section id="tryincreasetobeissuedtokens">
<span id="id15"></span><h3>tryIncreaseToBeIssuedTokens<a class="headerlink" href="#tryincreasetobeissuedtokens" title="Permalink to this headline"></a></h3>
<p>During an issue request function (<a class="reference internal" href="issue.html#requestissue"><span class="std std-ref">requestIssue</span></a>), a user must be able to assign a vault to the issue request. As a vault can be assigned to multiple issue requests, race conditions may occur. To prevent race conditions, a Vault’s collateral is <em>reserved</em> when an <code class="docutils literal notranslate"><span class="pre">IssueRequest</span></code> is created - <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> specifies how much interBTC is to be issued (and the reserved collateral is then calculated based on <a class="reference internal" href="oracle.html#oracle-function-get-price"><span class="std std-ref">get_price</span></a>).</p>
<section id="id16">
<h4>Specification<a class="headerlink" href="#id16" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">tryIncreaseToBeIssuedTokens(vaultId,</span> <span class="pre">tokens)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC to be locked.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#increasetobeissuedtokensevent"><span class="std std-ref">IncreaseToBeIssuedTokens</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST be set to <code class="docutils literal notranslate"><span class="pre">RUNNING:0</span></code>.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
<li><p>The vault MUST have sufficient collateral to remain above the <code class="docutils literal notranslate"><span class="pre">SecureCollateralThreshold</span></code> after issuing <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>The vault status MUST be <cite>Active(true)</cite></p></li>
<li><p>The vault MUST NOT be banned</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>The vault’s <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> MUST be increased by an amount of <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
</ul>
</section>
</section>
<section id="decreasetobeissuedtokens">
<span id="id17"></span><h3>decreaseToBeIssuedTokens<a class="headerlink" href="#decreasetobeissuedtokens" title="Permalink to this headline"></a></h3>
<p>A Vault’s committed tokens are unreserved when an issue request (<a class="reference internal" href="issue.html#cancelissue"><span class="std std-ref">cancelIssue</span></a>) is cancelled due to a timeout (failure!). If the vault has been liquidated, the tokens are instead unreserved on the liquidation vault.</p>
<section id="id18">
<h4>Specification<a class="headerlink" href="#id18" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">decreaseToBeIssuedTokens(vaultId,</span> <span class="pre">tokens)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC to be unreserved.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#decreasetobeissuedtokensevent"><span class="std std-ref">DecreaseToBeIssuedTokens</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST NOT be set to <code class="docutils literal notranslate"><span class="pre">SHUTDOWN:</span> <span class="pre">2</span></code>.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
<li><p>If the vault is not liquidated, it MUST have at least <code class="docutils literal notranslate"><span class="pre">tokens</span></code> <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code>.</p></li>
<li><p>If the vault <em>is</em> liquidated, it MUST have at least <code class="docutils literal notranslate"><span class="pre">tokens</span></code> <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code>.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>If the vault is <em>not</em> liquidated, its <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> MUST be decreased by an amount of <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If the vault <em>is</em> liquidated, the liquidation vault’s <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> MUST be decreased by an amount of <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
</ul>
</section>
</section>
<section id="issuetokens">
<span id="id19"></span><h3>issueTokens<a class="headerlink" href="#issuetokens" title="Permalink to this headline"></a></h3>
<p>The issue process completes when a user calls the <a class="reference internal" href="issue.html#executeissue"><span class="std std-ref">executeIssue</span></a> function and provides a valid proof for sending BTC to the vault. At this point, the <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> assigned to a vault are decreased and the <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code> balance is increased by the <code class="docutils literal notranslate"><span class="pre">amount</span></code> of issued tokens.</p>
<section id="id20">
<h4>Specification<a class="headerlink" href="#id20" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">issueTokens(vaultId,</span> <span class="pre">amount)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC that were just issued.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#issuetokensevent"><span class="std std-ref">IssueTokens</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST NOT be set to <code class="docutils literal notranslate"><span class="pre">SHUTDOWN:</span> <span class="pre">2</span></code>.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
<li><p>If the vault is <em>not</em> liquidated, its <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> MUST be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If the vault <em>is</em> liquidated, the <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> of the liquidation vault MUST be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>If the vault is <em>not</em> liquidated, its <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> MUST be decreased by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>, while its <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code> MUST be increased by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If the vault is <em>not</em> liquidated, function <a class="reference internal" href="reward.html#reward-depositstake"><span class="std std-ref">depositStake</span></a> MUST complete successfully - parameterized by <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> and <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If the vault <em>is</em> liquidated, the <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> of the liquidation vault MUST be decreased by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>, while its <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code> MUST be increased by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
</ul>
</section>
</section>
<section id="tryincreasetoberedeemedtokens">
<span id="id21"></span><h3>tryIncreaseToBeRedeemedTokens<a class="headerlink" href="#tryincreasetoberedeemedtokens" title="Permalink to this headline"></a></h3>
<p>Add an amount of tokens to the <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> balance of a vault. This function serves as a prevention against race conditions in the redeem and replace procedures.
If, for example, a vault would receive two redeem requests at the same time that have a higher amount of tokens to be issued than his <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code> balance, one of the two redeem requests should be rejected.</p>
<section id="id22">
<h4>Specification<a class="headerlink" href="#id22" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">tryIncreaseToBeRedeemedTokens(vaultId,</span> <span class="pre">tokens)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC to be redeemed.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#increasetoberedeemedtokensevent"><span class="std std-ref">IncreaseToBeRedeemedTokens</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST NOT be set to <code class="docutils literal notranslate"><span class="pre">SHUTDOWN:</span> <span class="pre">2</span></code>.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
<li><p>The vault MUST NOT be liquidated.</p></li>
<li><p>The vault MUST have sufficient tokens to reserve, i.e. <code class="docutils literal notranslate"><span class="pre">tokens</span></code> must be less than or equal to <code class="docutils literal notranslate"><span class="pre">issuedTokens</span> <span class="pre">-</span> <span class="pre">toBeRedeemedTokens</span></code>.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>The vault’s <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> MUST be increased by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
</ul>
</section>
</section>
<section id="decreasetoberedeemedtokens">
<span id="id23"></span><h3>decreaseToBeRedeemedTokens<a class="headerlink" href="#decreasetoberedeemedtokens" title="Permalink to this headline"></a></h3>
<p>Subtract an amount tokens from the <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> balance of a vault. This function is called from <a class="reference internal" href="redeem.html#cancelredeem"><span class="std std-ref">cancelRedeem</span></a>.</p>
<section id="id24">
<h4>Specification<a class="headerlink" href="#id24" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">decreaseToBeRedeemedTokens(vaultId,</span> <span class="pre">tokens)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC not to be redeemed.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#decreasetoberedeemedtokensevent"><span class="std std-ref">DecreaseToBeRedeemedTokens</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component must not be set to <code class="docutils literal notranslate"><span class="pre">SHUTDOWN:</span> <span class="pre">2</span></code>.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
<li><p>If the vault is <em>not</em> liquidated, its <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> MUST be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If the vault <em>is</em> liquidated, the <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> of the liquidation vault MUST be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>If the vault is <em>not</em> liquidated, its <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> MUST be decreased by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If the vault <em>is</em> liquidated, the <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> of the liquidation vault MUST be decreased by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
</ul>
</section>
</section>
<section id="decreasetokens">
<span id="id25"></span><h3>decreaseTokens<a class="headerlink" href="#decreasetokens" title="Permalink to this headline"></a></h3>
<p>Decreases both the <code class="docutils literal notranslate"><span class="pre">toBeRedeemed</span></code> and <code class="docutils literal notranslate"><span class="pre">issued</span></code> tokens, effectively burning the tokens. This is called from <a class="reference internal" href="redeem.html#cancelredeem"><span class="std std-ref">cancelRedeem</span></a>.</p>
<section id="id26">
<h4>Specification<a class="headerlink" href="#id26" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">decreaseTokens(vaultId,</span> <span class="pre">user,</span> <span class="pre">tokens)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">userId</span></code>: The BTC Parachain address of the user that made the redeem request.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC that were not redeemed.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#decreasetokensevent"><span class="std std-ref">DecreaseTokens</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component must not be set to <code class="docutils literal notranslate"><span class="pre">SHUTDOWN:</span> <span class="pre">2</span></code>.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
<li><p>If the vault is <em>not</em> liquidated, its <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> and <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code> MUST be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If the vault <em>is</em> liquidated, the <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> and <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code> of the liquidation vault MUST be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>If the vault is <em>not</em> liquidated, its <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> and <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code> MUST be decreased by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If the vault <em>is</em> liquidated, the <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> and <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code> of the liquidation vault MUST be decreased by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
</ul>
</section>
</section>
<section id="redeemtokens">
<span id="id27"></span><h3>redeemTokens<a class="headerlink" href="#redeemtokens" title="Permalink to this headline"></a></h3>
<p>Reduces the to-be-redeemed tokens when a redeem request completes</p>
<section id="id28">
<h4>Specification<a class="headerlink" href="#id28" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">redeemTokens(vaultId,</span> <span class="pre">tokens,</span> <span class="pre">premium,</span> <span class="pre">redeemerId)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: the id of the vault from which to redeem tokens</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: the amount of tokens to be decreased</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">premium</span></code>: amount of collateral to be rewarded to the redeemer if the vault is not liquidated yet</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">redeemerId</span></code>: the id of the redeemer</p></li>
</ul>
<p><em>Events</em></p>
<p>One of:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#redeemtokensevent"><span class="std std-ref">RedeemTokens</span></a></p></li>
<li><p><a class="reference internal" href="#redeemtokenspremiumevent"><span class="std std-ref">RedeemTokensPremium</span></a></p></li>
<li><p><a class="reference internal" href="#redeemtokensliquidatedvaultevent"><span class="std std-ref">RedeemTokensLiquidatedVault</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul>
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST NOT be set to <code class="docutils literal notranslate"><span class="pre">SHUTDOWN:</span> <span class="pre">2</span></code>.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
<li><p>If the vault is <em>not</em> liquidated:</p>
<blockquote>
<div><ul class="simple">
<li><p>The vault’s <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> must be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">premium</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>, then the vault’s <code class="docutils literal notranslate"><span class="pre">backingCollateral</span></code> (as calculated via <a class="reference internal" href="staking.html#computestakeatindex"><span class="std std-ref">computeStakeAtIndex</span></a>) must be greater than or equal to <code class="docutils literal notranslate"><span class="pre">premium</span></code>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If the vault <em>is</em> liquidated, then the liquidation vault’s <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> must be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code></p></li>
</ul>
<p><em>Postconditions</em></p>
<ul>
<li><p>If the vault <em>IS NOT</em> liquidated:</p>
<blockquote>
<div><ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">premium</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>, then <code class="docutils literal notranslate"><span class="pre">premium</span></code> MUST be transferred from the vault’s collateral to the redeemer’s free balance.</p></li>
<li><p>Function <a class="reference internal" href="reward.html#reward-withdrawstake"><span class="std std-ref">withdrawStake</span></a> MUST complete successfully - parameterized by <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> and <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If the vault <em>IS</em> liquidated:</p>
<blockquote>
<div><ul class="simple">
<li><p>The amount <code class="docutils literal notranslate"><span class="pre">toBeReleased</span></code> is calculated as <code class="docutils literal notranslate"><span class="pre">(vault.liquidatedCollateral</span> <span class="pre">*</span> <span class="pre">tokens)</span> <span class="pre">/</span> <span class="pre">vault.toBeRedeemedTokens</span></code>.</p></li>
<li><p>The vault’s <code class="docutils literal notranslate"><span class="pre">liquidatedCollateral</span></code> MUST decrease by <code class="docutils literal notranslate"><span class="pre">toBeReleased</span></code>.</p></li>
<li><p>Function <a class="reference internal" href="staking.html#staking-depositstake"><span class="std std-ref">depositStake</span></a> MUST complete successfully - parameterized by <code class="docutils literal notranslate"><span class="pre">vaultId</span></code>, <code class="docutils literal notranslate"><span class="pre">vaultId</span></code>, and <code class="docutils literal notranslate"><span class="pre">toBeReleased</span></code>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The vault’s <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> MUST decrease by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>The vault’s <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code> MUST decrease by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
</ul>
</section>
</section>
<section id="redeemtokensliquidation">
<span id="id29"></span><h3>redeemTokensLiquidation<a class="headerlink" href="#redeemtokensliquidation" title="Permalink to this headline"></a></h3>
<p>Handles redeem requests which are executed against the LiquidationVault in the given currency. Reduces the issued token of the LiquidationVault and slashes the
corresponding amount of collateral.</p>
<section id="id30">
<h4>Specification<a class="headerlink" href="#id30" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">redeemTokensLiquidation(redeemerId,</span> <span class="pre">tokens,</span> <span class="pre">currencyId)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">currencyId</span></code>: The currency of the to be received collateral.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">redeemerId</span></code> : The account of the user redeeming interBTC.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC to be burned, in exchange for collateral.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#redeemtokensliquidationevent"><span class="std std-ref">RedeemTokensLiquidation</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST NOT be set to <code class="docutils literal notranslate"><span class="pre">SHUTDOWN:</span> <span class="pre">2</span></code>.</p></li>
<li><p>The liquidation vault with the given <code class="docutils literal notranslate"><span class="pre">currencyId</span></code> MUST have sufficient tokens, i.e. <code class="docutils literal notranslate"><span class="pre">tokens</span></code> MUST be less than or equal to its <code class="docutils literal notranslate"><span class="pre">issuedTokens</span> <span class="pre">-</span> <span class="pre">toBeRedeemedTokens</span></code>.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>The used liquidation vault MUST be the one with the given <code class="docutils literal notranslate"><span class="pre">currencyId</span></code>.</p></li>
<li><p>The liquidation vault’s <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code> MUST decrease by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>The liquidation vault MUST have transferred collateral to redeemer: an amount of <code class="docutils literal notranslate"><span class="pre">(tokens</span> <span class="pre">/</span> <span class="pre">(liquidationVault.issuedTokens</span> <span class="pre">+</span> <span class="pre">liquidationVault.toBeIssuedTokens</span> <span class="pre">-</span> <span class="pre">liquidationVault.toBeRedeemedTokens)</span> <span class="pre">*</span> <span class="pre">liquidationVault.backingCollateral</span></code>.</p></li>
</ul>
</section>
</section>
<section id="increasetobereplacedtokens">
<span id="id31"></span><h3>increaseToBeReplacedTokens<a class="headerlink" href="#increasetobereplacedtokens" title="Permalink to this headline"></a></h3>
<p>Increases the toBeReplaced tokens of a vault, which indicates how many tokens other vaults can replace in total.</p>
<section id="id32">
<h4>Specification<a class="headerlink" href="#id32" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">increaseToBeReplacedTokens(oldVault,</span> <span class="pre">tokens,</span> <span class="pre">collateral)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: Account identifier of the vault to be replaced.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC replaced.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">collateral</span></code>: The extra collateral provided by the new vault as griefing collateral for potential accepted replaces.</p></li>
</ul>
<p><em>Returns</em></p>
<ul class="simple">
<li><p>A tuple of the new total <code class="docutils literal notranslate"><span class="pre">toBeReplacedTokens</span></code> and <code class="docutils literal notranslate"><span class="pre">replaceCollateral</span></code>.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#increasetobereplacedtokensevent"><span class="std std-ref">IncreaseToBeReplacedTokens</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST NOT be set to <code class="docutils literal notranslate"><span class="pre">SHUTDOWN:</span> <span class="pre">2</span></code>.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
<li><p>The vault MUST NOT be liquidated.</p></li>
<li><p>The vault’s increased <code class="docutils literal notranslate"><span class="pre">toBeReplaceedTokens</span></code> MUST NOT exceed <code class="docutils literal notranslate"><span class="pre">issuedTokens</span> <span class="pre">-</span> <span class="pre">toBeRedeemedTokens</span></code>.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>The vault’s <code class="docutils literal notranslate"><span class="pre">toBeReplaceTokens</span></code> MUST be increased by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>The vault’s <code class="docutils literal notranslate"><span class="pre">replaceCollateral</span></code> MUST be increased by <code class="docutils literal notranslate"><span class="pre">collateral</span></code>.</p></li>
</ul>
</section>
</section>
<section id="decreasetobereplacedtokens">
<span id="id33"></span><h3>decreaseToBeReplacedTokens<a class="headerlink" href="#decreasetobereplacedtokens" title="Permalink to this headline"></a></h3>
<p>Decreases the toBeReplaced tokens of a vault, which indicates how many tokens other vaults can replace in total.</p>
<section id="id34">
<h4>Specification<a class="headerlink" href="#id34" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">decreaseToBeReplacedTokens(oldVault,</span> <span class="pre">tokens)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vaultId</span></code>: Account identifier of the vault to be replaced.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC replaced.</p></li>
</ul>
<p><em>Returns</em></p>
<ul class="simple">
<li><p>A tuple of the new total <code class="docutils literal notranslate"><span class="pre">toBeReplacedTokens</span></code> and <code class="docutils literal notranslate"><span class="pre">replaceCollateral</span></code>.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#decreasetobereplacedtokensevent"><span class="std std-ref">DecreaseToBeReplacedTokens</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST NOT be set to <code class="docutils literal notranslate"><span class="pre">SHUTDOWN:</span> <span class="pre">2</span></code>.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">vaultId</span></code> MUST be registered.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>The vault’s <code class="docutils literal notranslate"><span class="pre">replaceCollateral</span></code> MUST be decreased by <code class="docutils literal notranslate"><span class="pre">(min(tokens,</span> <span class="pre">toBeReplacedTokens)</span> <span class="pre">/</span> <span class="pre">toBeReplacedTokens)</span> <span class="pre">*</span> <span class="pre">replaceCollateral</span></code>.</p></li>
<li><p>The vault’s <code class="docutils literal notranslate"><span class="pre">toBeReplaceTokens</span></code> MUST be decreased by <code class="docutils literal notranslate"><span class="pre">min(tokens,</span> <span class="pre">toBeReplacedTokens)</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>the <code class="docutils literal notranslate"><span class="pre">replaceCollateral</span></code> is not actually unlocked - this is the responsibility of the caller. It is implemented this way, because in <a class="reference internal" href="redeem.html#requestredeem"><span class="std std-ref">requestRedeem</span></a> it needs to be unlocked, whereas in <a class="reference internal" href="replace.html#requestreplace"><span class="std std-ref">requestReplace</span></a> it must remain locked.</p>
</div>
</section>
</section>
<section id="replacetokens">
<span id="id35"></span><h3>replaceTokens<a class="headerlink" href="#replacetokens" title="Permalink to this headline"></a></h3>
<p>When a replace request successfully completes, the <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> and the <code class="docutils literal notranslate"><span class="pre">issuedToken</span></code> balance must be reduced to reflect that removal of interBTC from the <code class="docutils literal notranslate"><span class="pre">oldVault</span></code>.Consequently, the <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code> of the <code class="docutils literal notranslate"><span class="pre">newVault</span></code> need to be increased by the same amount.</p>
<section id="id36">
<h4>Specification<a class="headerlink" href="#id36" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">replaceTokens(oldVault,</span> <span class="pre">newVault,</span> <span class="pre">tokens,</span> <span class="pre">collateral)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">oldVault</span></code>: Account identifier of the vault to be replaced.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">newVault</span></code>: Account identifier of the vault accepting the replace request.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC replaced.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">collateral</span></code>: The collateral provided by the new vault.</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#replacetokensevent"><span class="std std-ref">ReplaceTokens</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST NOT be set to <code class="docutils literal notranslate"><span class="pre">SHUTDOWN:</span> <span class="pre">2</span></code>.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">oldVault</span></code> MUST be registered.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">newVault</span></code> MUST be registered.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">oldVault</span></code> is <em>not</em> liquidated, its <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> and <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code> MUST be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">oldVault</span></code> <em>is</em> liquidated, the liquidation vault’s <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> and <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code> MUST be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">newVault</span></code> is <em>not</em> liquidated, its <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> MUST be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">newVault</span></code> <em>is</em> liquidated, the liquidation vault’s <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> MUST be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">oldVault</span></code> <em>IS</em> liquidated:</p>
<blockquote>
<div><ul class="simple">
<li><p>The amount <code class="docutils literal notranslate"><span class="pre">toBeReleased</span></code> MUST be calculated as <code class="docutils literal notranslate"><span class="pre">(oldVault.liquidatedCollateral</span> <span class="pre">*</span> <span class="pre">tokens)</span> <span class="pre">/</span> <span class="pre">oldVault.toBeRedeemedTokens</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">oldVault</span></code>’s <code class="docutils literal notranslate"><span class="pre">liquidatedCollateral</span></code> MUST decrease by <code class="docutils literal notranslate"><span class="pre">toBeReleased</span></code>.</p></li>
<li><p>Function <a class="reference internal" href="staking.html#staking-depositstake"><span class="std std-ref">depositStake</span></a> MUST complete successfully - parameterized by <code class="docutils literal notranslate"><span class="pre">oldVault</span></code>, <code class="docutils literal notranslate"><span class="pre">oldVault</span></code> and <code class="docutils literal notranslate"><span class="pre">toBeReleased</span></code>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">oldVault</span></code>’s <code class="docutils literal notranslate"><span class="pre">toBeRedeemed</span></code> MUST decrease by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">oldVault</span></code>’s <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code> MUST decrease by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">newVault</span></code>’s <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> MUST decrease by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">newVault</span></code>’s <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code> MUST increase by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
</ul>
</section>
</section>
<section id="cancelreplacetokens">
<span id="id37"></span><h3>cancelReplaceTokens<a class="headerlink" href="#cancelreplacetokens" title="Permalink to this headline"></a></h3>
<p>Cancels a replace: decrease the old-vault’s to-be-redeemed tokens, and the new-vault’s to-be-issued tokens. If one or both of the vaults has been liquidated, the change is forwarded to the liquidation vault.</p>
<section id="id38">
<h4>Specification<a class="headerlink" href="#id38" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">cancelReplaceTokens(oldVault,</span> <span class="pre">newVault,</span> <span class="pre">tokens)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">oldVault</span></code>: Account identifier of the vault to be replaced.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">newVault</span></code>: Account identifier of the vault accepting the replace request.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC replaced.</p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The BTC Parachain status in the <a class="reference internal" href="security.html#security"><span class="std std-ref">Security</span></a> component MUST NOT be set to <code class="docutils literal notranslate"><span class="pre">SHUTDOWN:</span> <span class="pre">2</span></code>.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">oldVault</span></code> MUST be registered.</p></li>
<li><p>A vault with id <code class="docutils literal notranslate"><span class="pre">newVault</span></code> MUST be registered.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">oldVault</span></code> is <em>not</em> liquidated, its <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> MUST be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">oldVault</span></code> <em>is</em> liquidated, the liquidation vault’s <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> MUST be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">newVault</span></code> is <em>not</em> liquidated, its <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> MUST be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">newVault</span></code> <em>is</em> liquidated, the liquidation vault’s <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> MUST be greater than or equal to <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">oldVault</span></code> is <em>not</em> liquidated, its <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> MUST be decreased by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">oldVault</span></code> <em>is</em> liquidated, the liquidation vault’s <code class="docutils literal notranslate"><span class="pre">toBeRedeemedTokens</span></code> MUST be decreased by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">newVault</span></code> is <em>not</em> liquidated, its <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> MUST be decreased by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">newVault</span></code> <em>is</em> liquidated, the liquidation vault’s  <code class="docutils literal notranslate"><span class="pre">toBeIssuedTokens</span></code> MUST be decreased by <code class="docutils literal notranslate"><span class="pre">tokens</span></code>.</p></li>
</ul>
</section>
</section>
<section id="liquidatevault">
<span id="id39"></span><h3>liquidateVault<a class="headerlink" href="#liquidatevault" title="Permalink to this headline"></a></h3>
<p>Liquidates a vault, transferring token balances to the <code class="docutils literal notranslate"><span class="pre">LiquidationVault</span></code>, as well as collateral.</p>
<section id="id40">
<h4>Specification<a class="headerlink" href="#id40" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">liquidateVault(vault,</span> <span class="pre">reporter)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: Account identifier of the vault to be liquidated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reporter</span></code>: [Optional] Account that initiated the liquidation (e.g. theft report).</p></li>
</ul>
<p><em>Events</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#liquidatevaultevent"><span class="std std-ref">LiquidateVault</span></a></p></li>
</ul>
<p><em>Preconditions</em></p>
<p><em>Postconditions</em></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">usedCollateral</span></code> MUST be calculated as <code class="docutils literal notranslate"><span class="pre">exchangeRate</span> <span class="pre">*</span> <span class="pre">(issuedTokens</span> <span class="pre">+</span> <span class="pre">toBeIssuedTokens))</span> <span class="pre">*</span> <span class="pre">secureCollateralThreshold</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usedCollateral</span></code> MUST be set to <code class="docutils literal notranslate"><span class="pre">backingCollateral</span></code> if <code class="docutils literal notranslate"><span class="pre">backingCollateral</span> <span class="pre">&lt;</span> <span class="pre">usedCollateral</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usedTokens</span></code> MUST be calculated as <code class="docutils literal notranslate"><span class="pre">issuedTokens</span> <span class="pre">+</span> <span class="pre">toBeIssuedTokens</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">toBeLiquidated</span></code> MUST be calculated as <code class="docutils literal notranslate"><span class="pre">(usedCollateral</span> <span class="pre">*</span> <span class="pre">(usedTokens</span> <span class="pre">-</span> <span class="pre">toBeRedeemedTokens))</span> <span class="pre">/</span> <span class="pre">usedTokens</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remainingCollateral</span></code> MUST be calculated as <code class="docutils literal notranslate"><span class="pre">max(0,</span> <span class="pre">usedCollateral</span> <span class="pre">-</span> <span class="pre">toBeLiquidated)</span></code>.</p></li>
<li><p>Function <a class="reference internal" href="reward.html#reward-withdrawstake"><span class="std std-ref">withdrawStake</span></a> MUST complete successfully - parameterized by <code class="docutils literal notranslate"><span class="pre">vault</span></code> and <code class="docutils literal notranslate"><span class="pre">issuedTokens</span></code>.</p></li>
<li><p>Function <a class="reference internal" href="staking.html#staking-withdrawstake"><span class="std std-ref">withdrawStake</span></a> MUST complete successfully - parameterized by <code class="docutils literal notranslate"><span class="pre">vault</span></code> and <code class="docutils literal notranslate"><span class="pre">remainingCollateral</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">liquidatedCollateral</span></code> MUST be increased by <code class="docutils literal notranslate"><span class="pre">remainingCollateral</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">toWithdraw</span></code> MUST be calculated as <code class="docutils literal notranslate"><span class="pre">toBeLiquidated</span> <span class="pre">-</span> <span class="pre">backingCollateral</span></code> OR <code class="docutils literal notranslate"><span class="pre">toBeLiquidated</span></code> if <code class="docutils literal notranslate"><span class="pre">backingCollateral</span> <span class="pre">&gt;</span> <span class="pre">toBeLiquidated</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">toSlash</span></code> MUST be calculated as the remainder of the previous calculation.</p></li>
<li><p>Function <a class="reference internal" href="staking.html#staking-withdrawstake"><span class="std std-ref">withdrawStake</span></a> MUST complete successfully - parameterized by <code class="docutils literal notranslate"><span class="pre">vault</span></code> and <code class="docutils literal notranslate"><span class="pre">toWithdraw</span></code>.</p></li>
<li><p>Function <a class="reference internal" href="staking.html#slashstake"><span class="std std-ref">slashStake</span></a> MUST complete successfully - parameterized by <code class="docutils literal notranslate"><span class="pre">vault</span></code> and <code class="docutils literal notranslate"><span class="pre">toSlash</span></code>.</p></li>
<li><p>The liquidation vault MUST be updated as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">liquidationVault.issuedTokens</span></code> MUST increase by <code class="docutils literal notranslate"><span class="pre">vault.issuedTokens</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">liquidationVault.toBeIssuedTokens</span></code> MUST increase by <code class="docutils literal notranslate"><span class="pre">vault.toBeIssuedTokens</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">liquidationVault.toBeRedeemedTokens</span></code> MUST increase by <code class="docutils literal notranslate"><span class="pre">vault.toBeRedeemedTokens</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>The vault MUST be updated as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault.issuedTokens</span></code> MUST be set to zero</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vault.toBeIssuedTokens</span></code> MUST be set to zero</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If <cite>reporter</cite> IS specified, <cite>min(TheftFee(liquidatedAmountinBTC), TheftFeeMax)</cite> MUST be transferred from the liquidated vault to the <code class="docutils literal notranslate"><span class="pre">reporter</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a vault successfully executes a replace after having been liquidated, it receives some of its confiscated collateral back.</p>
</div>
</section>
</section>
<section id="getmaxnominationratio">
<span id="id41"></span><h3>getMaxNominationRatio<a class="headerlink" href="#getmaxnominationratio" title="Permalink to this headline"></a></h3>
<p>Returns the nomination ratio, denoting the maximum amount of collateral that can be nominated in a given currency.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MaxNominationRatio</span> <span class="pre">=</span> <span class="pre">(SecureCollateralThreshold</span> <span class="pre">/</span> <span class="pre">PremiumRedeemThreshold)</span> <span class="pre">-</span> <span class="pre">1)</span></code></p></li>
</ul>
<p><em>Example</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SecureCollateralThreshold</span> <span class="pre">=</span> <span class="pre">1.5</span> <span class="pre">(150%)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PremiumRedeemThreshold</span> <span class="pre">=</span> <span class="pre">1.2</span> <span class="pre">(120%)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MaxNominationRatio</span> <span class="pre">=</span> <span class="pre">(1.5</span> <span class="pre">/</span> <span class="pre">1.2)</span> <span class="pre">-</span> <span class="pre">1</span> <span class="pre">=</span> <span class="pre">0.25</span> <span class="pre">(25%)</span></code></p></li>
</ul>
<p>In this example, a Vault with 10 DOT locked as collateral can only receive 2.5 DOT through nomination.</p>
</section>
</section>
<section id="events">
<h2>Events<a class="headerlink" href="#events" title="Permalink to this headline"></a></h2>
<section id="registervault">
<span id="registervaultevent"></span><h3>RegisterVault<a class="headerlink" href="#registervault" title="Permalink to this headline"></a></h3>
<p>Emit an event stating that a new vault (<code class="docutils literal notranslate"><span class="pre">vault</span></code>) was registered and provide information on the Vault’s collateral (<code class="docutils literal notranslate"><span class="pre">collateral</span></code>).</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">RegisterVault(vault,</span> <span class="pre">collateral)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: The account of the vault to be registered.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">collateral</span></code>: the amount of the to-be-locked collateral.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#vault-registry-function-register-vault"><span class="std std-ref">register_vault</span></a></p></li>
</ul>
</section>
<section id="depositcollateral">
<span id="depositcollateralevent"></span><h3>DepositCollateral<a class="headerlink" href="#depositcollateral" title="Permalink to this headline"></a></h3>
<p>Emit an event stating how much new (<code class="docutils literal notranslate"><span class="pre">newCollateral</span></code>), total collateral (<code class="docutils literal notranslate"><span class="pre">totalCollateral</span></code>) and freely available collateral (<code class="docutils literal notranslate"><span class="pre">freeCollateral</span></code>) the vault calling this function has locked.</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">DepositCollateral(vault,</span> <span class="pre">newCollateral,</span> <span class="pre">totalCollateral,</span> <span class="pre">freeCollateral)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: The account of the vault locking collateral.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">newCollateral</span></code>: to-be-locked collateral in DOT.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">totalCollateral</span></code>: total collateral in DOT.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">freeCollateral</span></code>: collateral not “occupied” with interBTC in DOT.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#vault-registry-function-deposit-collateral"><span class="std std-ref">deposit_collateral</span></a></p></li>
</ul>
</section>
<section id="withdrawcollateralevent">
<span id="id42"></span><h3>WithdrawCollateral<a class="headerlink" href="#withdrawcollateralevent" title="Permalink to this headline"></a></h3>
<p>Emit emit an event stating how much collateral was withdrawn by the vault and total collateral a vault has left.</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">WithdrawCollateral(vault,</span> <span class="pre">withdrawAmount,</span> <span class="pre">totalCollateral)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: The account of the vault locking collateral.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">withdrawAmount</span></code>: To-be-withdrawn collateral in DOT.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">totalCollateral</span></code>: total collateral in DOT.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#withdrawcollateral"><span class="std std-ref">withdrawCollateral</span></a></p></li>
</ul>
</section>
<section id="registeraddressevent">
<span id="id43"></span><h3>RegisterAddress<a class="headerlink" href="#registeraddressevent" title="Permalink to this headline"></a></h3>
<p>Emit an event stating that a vault (<code class="docutils literal notranslate"><span class="pre">vault</span></code>) registered a new address (<code class="docutils literal notranslate"><span class="pre">address</span></code>).</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">RegisterAddress(vault,</span> <span class="pre">address)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: The account of the vault to be registered.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">address</span></code>: The added address</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#registeraddress"><span class="std std-ref">registerAddress</span></a></p></li>
</ul>
</section>
<section id="updatepublickeyevent">
<span id="id44"></span><h3>UpdatePublicKey<a class="headerlink" href="#updatepublickeyevent" title="Permalink to this headline"></a></h3>
<p>Emit an event stating that a vault (<code class="docutils literal notranslate"><span class="pre">vault</span></code>) registered a new address (<code class="docutils literal notranslate"><span class="pre">address</span></code>).</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">UpdatePublicKey(vault,</span> <span class="pre">publicKey)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: the account of the vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">publicKey</span></code>: the new BTC public key of the vault.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#updatepublickey"><span class="std std-ref">updatePublicKey</span></a></p></li>
</ul>
</section>
<section id="increasetobeissuedtokens">
<span id="increasetobeissuedtokensevent"></span><h3>IncreaseToBeIssuedTokens<a class="headerlink" href="#increasetobeissuedtokens" title="Permalink to this headline"></a></h3>
<p>Emit</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">IncreaseToBeIssuedTokens(vaultId,</span> <span class="pre">tokens)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC to be locked.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#tryincreasetobeissuedtokens"><span class="std std-ref">tryIncreaseToBeIssuedTokens</span></a></p></li>
</ul>
</section>
<section id="decreasetobeissuedtokensevent">
<span id="id45"></span><h3>DecreaseToBeIssuedTokens<a class="headerlink" href="#decreasetobeissuedtokensevent" title="Permalink to this headline"></a></h3>
<p>Emit</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">DecreaseToBeIssuedTokens(vaultId,</span> <span class="pre">tokens)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC to be unreserved.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#decreasetobeissuedtokens"><span class="std std-ref">decreaseToBeIssuedTokens</span></a></p></li>
</ul>
</section>
<section id="issuetokensevent">
<span id="id46"></span><h3>IssueTokens<a class="headerlink" href="#issuetokensevent" title="Permalink to this headline"></a></h3>
<p>Emit an event when an issue request is executed.</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">IssueTokens(vault,</span> <span class="pre">tokens)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC that were just issued.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#issuetokens"><span class="std std-ref">issueTokens</span></a></p></li>
</ul>
</section>
<section id="increasetoberedeemedtokens">
<span id="increasetoberedeemedtokensevent"></span><h3>IncreaseToBeRedeemedTokens<a class="headerlink" href="#increasetoberedeemedtokens" title="Permalink to this headline"></a></h3>
<p>Emit an event when a redeem request is requested.</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">IncreaseToBeRedeemedTokens(vault,</span> <span class="pre">tokens)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC to be redeemed.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#tryincreasetoberedeemedtokens"><span class="std std-ref">tryIncreaseToBeRedeemedTokens</span></a></p></li>
</ul>
</section>
<section id="decreasetoberedeemedtokensevent">
<span id="id47"></span><h3>DecreaseToBeRedeemedTokens<a class="headerlink" href="#decreasetoberedeemedtokensevent" title="Permalink to this headline"></a></h3>
<p>Emit an event when a replace request cannot be completed because the vault has too little tokens committed.</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">DecreaseToBeRedeemedTokens(vault,</span> <span class="pre">tokens)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC not to be redeemed.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#decreasetoberedeemedtokens"><span class="std std-ref">decreaseToBeRedeemedTokens</span></a></p></li>
</ul>
</section>
<section id="increasetobereplacedtokensevent">
<span id="id48"></span><h3>IncreaseToBeReplacedTokens<a class="headerlink" href="#increasetobereplacedtokensevent" title="Permalink to this headline"></a></h3>
<p>Emit an event when the <code class="docutils literal notranslate"><span class="pre">toBeReplacedTokens</span></code> is increased.</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">IncreaseToBeReplacedTokens(vault,</span> <span class="pre">tokens)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC to be replaced.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#increasetobereplacedtokens"><span class="std std-ref">increaseToBeReplacedTokens</span></a></p></li>
</ul>
</section>
<section id="decreasetobereplacedtokensevent">
<span id="id49"></span><h3>DecreaseToBeReplacedTokens<a class="headerlink" href="#decreasetobereplacedtokensevent" title="Permalink to this headline"></a></h3>
<p>Emit an event when the <code class="docutils literal notranslate"><span class="pre">toBeReplacedTokens</span></code> is decreased.</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">DecreaseToBeReplacedTokens(vault,</span> <span class="pre">tokens)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC not to be replaced.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#decreasetobereplacedtokens"><span class="std std-ref">decreaseToBeReplacedTokens</span></a></p></li>
</ul>
</section>
<section id="decreasetokensevent">
<span id="id50"></span><h3>DecreaseTokens<a class="headerlink" href="#decreasetokensevent" title="Permalink to this headline"></a></h3>
<p>Emit an event if a redeem request cannot be fulfilled.</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">DecreaseTokens(vault,</span> <span class="pre">user,</span> <span class="pre">tokens,</span> <span class="pre">collateral)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user</span></code>: The BTC Parachain address of the user that made the redeem request.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC that were not redeemed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">collateral</span></code>: The amount of collateral assigned to this request.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#decreasetokens"><span class="std std-ref">decreaseTokens</span></a></p></li>
</ul>
</section>
<section id="redeemtokensevent">
<span id="id51"></span><h3>RedeemTokens<a class="headerlink" href="#redeemtokensevent" title="Permalink to this headline"></a></h3>
<p>Emit an event when a redeem request successfully completes.</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">RedeemTokens(vault,</span> <span class="pre">tokens)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC redeemed.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#redeemtokens"><span class="std std-ref">redeemTokens</span></a></p></li>
</ul>
</section>
<section id="redeemtokenspremium">
<span id="redeemtokenspremiumevent"></span><h3>RedeemTokensPremium<a class="headerlink" href="#redeemtokenspremium" title="Permalink to this headline"></a></h3>
<p>Emit an event when a user is executing a redeem request that includes a premium.</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">RedeemTokensPremium(vault,</span> <span class="pre">tokens,</span> <span class="pre">premiumDOT,</span> <span class="pre">redeemer)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: The BTC Parachain address of the Vault.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC redeemed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">premiumDOT</span></code>: The amount of DOT to be paid to the user as a premium using the Vault’s released collateral.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">redeemer</span></code>: The user that redeems at a premium.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#redeemtokens"><span class="std std-ref">redeemTokens</span></a></p></li>
</ul>
</section>
<section id="redeemtokensliquidationevent">
<span id="id52"></span><h3>RedeemTokensLiquidation<a class="headerlink" href="#redeemtokensliquidationevent" title="Permalink to this headline"></a></h3>
<p>Emit an event when a redeem is executed under the <code class="docutils literal notranslate"><span class="pre">LIQUIDATION</span></code> status.</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">RedeemTokensLiquidation(redeemer,</span> <span class="pre">redeemDOTinBTC)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">redeemer</span></code> : The account of the user redeeming interBTC.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">redeemDOTinBTC</span></code>: The amount of interBTC to be redeemed in DOT with the <code class="docutils literal notranslate"><span class="pre">LiquidationVault</span></code>, denominated in BTC.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#redeemtokensliquidation"><span class="std std-ref">redeemTokensLiquidation</span></a></p></li>
</ul>
</section>
<section id="redeemtokensliquidatedvault">
<span id="redeemtokensliquidatedvaultevent"></span><h3>RedeemTokensLiquidatedVault<a class="headerlink" href="#redeemtokensliquidatedvault" title="Permalink to this headline"></a></h3>
<p>Emit an event when a redeem is executed on a liquidated vault.</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">RedeemTokensLiquidation(redeemer,</span> <span class="pre">tokens,</span> <span class="pre">unlockedCollateral)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">redeemer</span></code> : The account of the user redeeming interBTC.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC that have been refeemed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unlockedCollateral</span></code>: The amount of collateral that has been unlocked for the vault for this redeem.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#redeemtokens"><span class="std std-ref">redeemTokens</span></a></p></li>
</ul>
</section>
<section id="replacetokensevent">
<span id="id53"></span><h3>ReplaceTokens<a class="headerlink" href="#replacetokensevent" title="Permalink to this headline"></a></h3>
<p>Emit an event when a replace requests is successfully executed.</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">ReplaceTokens(oldVault,</span> <span class="pre">newVault,</span> <span class="pre">tokens,</span> <span class="pre">collateral)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">oldVault</span></code>: Account identifier of the vault to be replaced.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">newVault</span></code>: Account identifier of the vault accepting the replace request.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tokens</span></code>: The amount of interBTC replaced.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">collateral</span></code>: The collateral provided by the new vault.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#replacetokens"><span class="std std-ref">replaceTokens</span></a></p></li>
</ul>
</section>
<section id="liquidatevaultevent">
<span id="id54"></span><h3>LiquidateVault<a class="headerlink" href="#liquidatevaultevent" title="Permalink to this headline"></a></h3>
<p>Emit an event indicating that the vault with <code class="docutils literal notranslate"><span class="pre">vault</span></code> account identifier has been liquidated.</p>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">LiquidateVault(vault)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vault</span></code>: Account identifier of the vault to be liquidated.</p></li>
</ul>
<p><em>Functions</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#liquidatevault"><span class="std std-ref">liquidateVault</span></a></p></li>
</ul>
</section>
</section>
<section id="error-codes">
<h2>Error Codes<a class="headerlink" href="#error-codes" title="Permalink to this headline"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">InsufficientVaultCollateralAmount</span></code></p>
<ul class="simple">
<li><p><strong>Message</strong>: “The provided collateral was insufficient - it must be above <code class="docutils literal notranslate"><span class="pre">MinimumCollateralVault</span></code>.”</p></li>
<li><p><strong>Cause</strong>: The vault provided too little collateral, i.e. below the MinimumCollateralVault limit.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">VaultNotFound</span></code></p>
<ul class="simple">
<li><p><strong>Message</strong>: “The specified vault does not exist.”</p></li>
<li><p><strong>Cause</strong>: vault could not be found in <code class="docutils literal notranslate"><span class="pre">Vaults</span></code> mapping.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ERR_INSUFFICIENT_FREE_COLLATERAL</span></code></p>
<ul class="simple">
<li><p><strong>Message</strong>: “Not enough free collateral available.”</p></li>
<li><p><strong>Cause</strong>: The vault is trying to withdraw more collateral than is currently free.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ERR_EXCEEDING_VAULT_LIMIT</span></code></p>
<ul class="simple">
<li><p><strong>Message</strong>: “Issue request exceeds vault collateral limit.”</p></li>
<li><p><strong>Cause</strong>: The collateral provided by the vault combined with the exchange rate forms an upper limit on how much interBTC can be issued. The requested amount exceeds this limit.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ERR_INSUFFICIENT_TOKENS_COMMITTED</span></code></p>
<ul class="simple">
<li><p><strong>Message</strong>: “The requested amount of <code class="docutils literal notranslate"><span class="pre">tokens</span></code> exceeds the amount available to vault.”</p></li>
<li><p><strong>Cause</strong>: A user requests a redeem with an amount exceeding the vault’s tokens, or the vault is requesting replacement for more tokens than it has available.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ERR_VAULT_BANNED</span></code></p>
<ul class="simple">
<li><p><strong>Message</strong>: “Action not allowed on banned vault.”</p></li>
<li><p><strong>Cause</strong>: An illegal operation is attempted on a banned vault, e.g. an issue or redeem request.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ERR_ALREADY_REGISTERED</span></code></p>
<ul class="simple">
<li><p><strong>Message</strong>: “A vault with the given accountId is already registered.”</p></li>
<li><p><strong>Cause</strong>: A vault tries to register a vault that is already registered.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ERR_RESERVED_DEPOSIT_ADDRESS</span></code></p>
<ul class="simple">
<li><p><strong>Message</strong>: “Deposit address is already registered.”</p></li>
<li><p><strong>Cause</strong>: A vault tries to register a deposit address that is already in the system.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ERR_VAULT_NOT_BELOW_LIQUIDATION_THRESHOLD</span></code></p>
<ul class="simple">
<li><p><strong>Message</strong>: “Attempted to liquidate a vault that is not undercollateralized.”</p></li>
<li><p><strong>Cause</strong>: A vault has been reported for being undercollateralized, but at the moment of execution, it is no longer undercollateralized.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ERR_INVALID_PUBLIC_KEY</span></code></p>
<ul class="simple">
<li><p><strong>Message</strong>: “Deposit address could not be generated with the given public key.”</p></li>
<li><p><strong>Cause</strong>: An error occurred while attempting to generate a new deposit address for an issue request.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These are the errors defined in this pallet. It is possible that functions in this pallet return errors defined in other pallets.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="treasury.html" class="btn btn-neutral float-left" title="Treasury" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="nomination.html" class="btn btn-neutral float-right" title="Vault Nomination" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Interlay.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>