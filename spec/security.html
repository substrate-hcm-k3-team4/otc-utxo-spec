<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Security &mdash; interBTC Specification  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Relay" href="relay.html" />
    <link rel="prev" title="Replace" href="replace.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: grey" >
            <a href="../index.html" class="icon icon-home"> interBTC Specification
          </a>
              <div class="version">
                v5.6.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/at-a-glance.html">interBTC at a Glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/CbA.html">Cryptocurrency-backed Assets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/polkadot.html">Polkadot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/bitcoin.html">Bitcoin Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/accepted-format.html">Accepted Bitcoin Transaction Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">How to Read This Specification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Specification</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="btc-relay/index.html">BTC-Relay</a></li>
<li class="toctree-l1"><a class="reference internal" href="collateral.html">Collateral</a></li>
<li class="toctree-l1"><a class="reference internal" href="currency.html">Currency</a></li>
<li class="toctree-l1"><a class="reference internal" href="fee.html">Fee</a></li>
<li class="toctree-l1"><a class="reference internal" href="oracle.html">Oracle</a></li>
<li class="toctree-l1"><a class="reference internal" href="issue.html">Issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="refund.html">Refund</a></li>
<li class="toctree-l1"><a class="reference internal" href="redeem.html">Redeem</a></li>
<li class="toctree-l1"><a class="reference internal" href="replace.html">Replace</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#failure-modes">Failure Modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#oracle-offline">Oracle Offline</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#data-model">Data Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#enums">Enums</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#statuscode">StatusCode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#errorcode">ErrorCode</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#data-storage">Data Storage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scalars">Scalars</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#parachainstatus">ParachainStatus</a></li>
<li class="toctree-l4"><a class="reference internal" href="#errors">Errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nonce">Nonce</a></li>
<li class="toctree-l4"><a class="reference internal" href="#activeblockcount">ActiveBlockCount</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#functions">Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generatesecureid">generateSecureId</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#specification">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#hasexpired">hasExpired</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id7">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setparachainstatus">setParachainStatus</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id9">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#insertparachainerror">insertParachainError</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id11">Specification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#removeparachainerror">removeParachainError</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id13">Specification</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#events">Events</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#recoverfromerrors">RecoverFromErrors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="relay.html">Relay</a></li>
<li class="toctree-l1"><a class="reference internal" href="treasury.html">Treasury</a></li>
<li class="toctree-l1"><a class="reference internal" href="vault-registry.html">Vault Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="nomination.html">Vault Nomination</a></li>
<li class="toctree-l1"><a class="reference internal" href="reward.html">Reward</a></li>
<li class="toctree-l1"><a class="reference internal" href="staking.html">Staking</a></li>
<li class="toctree-l1"><a class="reference internal" href="escrow.html">Escrow</a></li>
<li class="toctree-l1"><a class="reference internal" href="governance.html">Governance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Security and Performance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/liquidations.html">Vault Liquidations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/xclaim-security.html">XCLAIM Security Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/btcrelay-security.html">BTC-Relay Security Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/performance.html">Performance Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Economics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../economics/incentives.html">Economic Incentives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../economics/fees.html">Fee Model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">All the rest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../other/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../other/interlay.html">Interlay</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: grey" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">interBTC Specification</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Security</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/spec/security.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="security">
<span id="id1"></span><h1>Security<a class="headerlink" href="#security" title="Permalink to this headline"></a></h1>
<p>The Security module is responsible for (1) tracking the status of the BTC Parachain, (2) the “active” blocks of the BTC Parachain, and (3) generating secure identifiers.</p>
<ol class="arabic simple">
<li><p><strong>Status</strong>: The BTC Parachain has three distinct states: <code class="docutils literal notranslate"><span class="pre">Running</span></code>, <code class="docutils literal notranslate"><span class="pre">Error</span></code>, and <code class="docutils literal notranslate"><span class="pre">Shutdown</span></code> which determine which functions can be used.</p></li>
<li><p><strong>Active Blocks</strong>: When the BTC Parachain is not in the <code class="docutils literal notranslate"><span class="pre">Running</span></code> state, certain operations are restricted. In order to prevent impact on the users and Vaults for the core issue, redeem, and replace operations, the BTC Parachain only considers Active Blocks for the Issue, Redeem, and Replace periods.</p></li>
<li><p><strong>Secure Identifiers</strong>: As part of the <a class="reference internal" href="../security_performance/xclaim-security.html#op-return"><span class="std std-ref">OP_RETURN</span></a> scheme to prevent replay attacks, the security module generates unique identifiers that are used to identify transactions.</p></li>
</ol>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<section id="failure-modes">
<h3>Failure Modes<a class="headerlink" href="#failure-modes" title="Permalink to this headline"></a></h3>
<p>The BTC Parachain can enter into an ERROR and SHUTDOWN state, depending on the occurred error.
An overview is provided in the figure below.</p>
<figure class="align-default" id="id14">
<img alt="State machine showing BTC Parachain failure modes" src="../_images/failureModes.png" />
<figcaption>
<p><span class="caption-number">Fig. 18 </span><span class="caption-text">(Informal) State machine showing the operational and failure modes and how to recover from or flag failures.</span><a class="headerlink" href="#id14" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Failure handling methods calls are <strong>restricted</strong>, i.e., can only be called by pre-determined roles.</p>
</section>
<section id="oracle-offline">
<span id="oracle-offline-err"></span><h3>Oracle Offline<a class="headerlink" href="#oracle-offline" title="Permalink to this headline"></a></h3>
<p>The <a class="reference internal" href="oracle.html#oracle"><span class="std std-ref">Oracle</span></a> experienced a liveness failure (no up-to-date exchange rate available).
The frequency of the oracle updates is defined in the Oracle module.</p>
<p><strong>Error code:</strong> <code class="docutils literal notranslate"><span class="pre">ORACLE_OFFLINE</span></code></p>
</section>
</section>
<section id="data-model">
<h2>Data Model<a class="headerlink" href="#data-model" title="Permalink to this headline"></a></h2>
<section id="enums">
<h3>Enums<a class="headerlink" href="#enums" title="Permalink to this headline"></a></h3>
<section id="statuscode">
<span id="id2"></span><h4>StatusCode<a class="headerlink" href="#statuscode" title="Permalink to this headline"></a></h4>
<p>Indicates ths status of the BTC Parachain.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RUNNING:</span> <span class="pre">0</span></code> - BTC Parachain fully operational</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR:</span> <span class="pre">1</span></code>- an error was detected in the BTC Parachain. See <code class="docutils literal notranslate"><span class="pre">Errors</span></code> for more details, i.e., the specific error codes (these determine how to react).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SHUTDOWN:</span> <span class="pre">2</span></code> - BTC Parachain operation fully suspended. This can only be achieved via manual intervention by the Governance Mechanism.</p></li>
</ul>
</section>
<section id="errorcode">
<span id="id3"></span><h4>ErrorCode<a class="headerlink" href="#errorcode" title="Permalink to this headline"></a></h4>
<p>Enum specifying error codes tracked in <code class="docutils literal notranslate"><span class="pre">Errors</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">NONE:</span> <span class="pre">0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ORACLE_OFFLINE:</span> <span class="pre">1</span></code></p></li>
</ul>
</section>
</section>
</section>
<section id="data-storage">
<h2>Data Storage<a class="headerlink" href="#data-storage" title="Permalink to this headline"></a></h2>
<section id="scalars">
<h3>Scalars<a class="headerlink" href="#scalars" title="Permalink to this headline"></a></h3>
<section id="parachainstatus">
<h4>ParachainStatus<a class="headerlink" href="#parachainstatus" title="Permalink to this headline"></a></h4>
<p>Stores the status code (<a class="reference internal" href="#statuscode"><span class="std std-ref">StatusCode</span></a>) which defines the current state of the BTC Parachain.</p>
</section>
<section id="errors">
<h4>Errors<a class="headerlink" href="#errors" title="Permalink to this headline"></a></h4>
<p>Stores the set of error codes (<a class="reference internal" href="#errorcode"><span class="std std-ref">ErrorCode</span></a>), indicating the reason for the error.</p>
</section>
<section id="nonce">
<h4>Nonce<a class="headerlink" href="#nonce" title="Permalink to this headline"></a></h4>
<p>Integer increment-only counter, used to prevent collisions when generating identifiers for e.g., redeem or replace requests (for OP_RETURN field in Bitcoin).</p>
</section>
<section id="activeblockcount">
<span id="id4"></span><h4>ActiveBlockCount<a class="headerlink" href="#activeblockcount" title="Permalink to this headline"></a></h4>
<p>A counter variable that increments every block when the parachain status is <code class="docutils literal notranslate"><span class="pre">RUNNING:0</span></code>. This variable is used to keep track of durations, such as issue/redeem/replace expiry.
This is used instead of the block number because if the parachain status is not <code class="docutils literal notranslate"><span class="pre">RUNNING:0</span></code>, no payment proofs can be submitted, so it would not be fair towards users and Vaults to continue counting down the (expiry) periods.
This field MUST be set to the current block height on initialization.</p>
</section>
</section>
</section>
<section id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline"></a></h2>
<section id="generatesecureid">
<span id="id5"></span><h3>generateSecureId<a class="headerlink" href="#generatesecureid" title="Permalink to this headline"></a></h3>
<p>Generates a unique ID using an account identifier, the <code class="docutils literal notranslate"><span class="pre">Nonce</span></code> and a random seed.</p>
<section id="specification">
<h4>Specification<a class="headerlink" href="#specification" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">generateSecureId(account)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">account</span></code>: account identifier (links this identifier to the AccountId associated with the process where this secure id is to be used, e.g., the user calling <a class="reference internal" href="issue.html#requestissue"><span class="std std-ref">requestIssue</span></a>).</p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>A parent block MUST exist (cannot be called on the parachain genesis block).</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>Nonce MUST be incremented by one.</p></li>
<li><p>MUST return the 256-bit hash of the <code class="docutils literal notranslate"><span class="pre">account`,</span> <span class="pre">``nonce</span></code>, and <code class="docutils literal notranslate"><span class="pre">parent_hash</span></code> (the hash of the previous block of this transaction).</p></li>
</ul>
</section>
</section>
<section id="hasexpired">
<span id="id6"></span><h3>hasExpired<a class="headerlink" href="#hasexpired" title="Permalink to this headline"></a></h3>
<p>Checks if the <code class="docutils literal notranslate"><span class="pre">period</span></code> has expired since the <code class="docutils literal notranslate"><span class="pre">opentime</span></code>. This calculation is based on the <a class="reference internal" href="#activeblockcount"><span class="std std-ref">ActiveBlockCount</span></a>.</p>
<section id="id7">
<h4>Specification<a class="headerlink" href="#id7" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">hasExpired(opentime,</span> <span class="pre">period)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">opentime</span></code>: the <a class="reference internal" href="#activeblockcount"><span class="std std-ref">ActiveBlockCount</span></a> at the time the issue/redeem/replace was opened.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">period</span></code>: the number of blocks the user or Vault has to complete the action.</p></li>
</ul>
<p><em>Preconditions</em></p>
<ul class="simple">
<li><p>The <cite>ActiveBlockCount</cite> MUST be greater than 0.</p></li>
</ul>
<p><em>Postconditions</em></p>
<ul class="simple">
<li><p>MUST return <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">opentime</span> <span class="pre">+</span> <span class="pre">period</span> <span class="pre">&lt;</span> <span class="pre">ActiveBlockCount</span></code>, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p></li>
</ul>
</section>
</section>
<section id="setparachainstatus">
<span id="id8"></span><h3>setParachainStatus<a class="headerlink" href="#setparachainstatus" title="Permalink to this headline"></a></h3>
<p>Governance sets a status code for the BTC Parachain manually.</p>
<section id="id9">
<h4>Specification<a class="headerlink" href="#id9" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">setParachainStatus(StatusCode)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">StatusCode</span></code>: the new StatusCode of the BTC-Parachain.</p></li>
</ul>
</section>
</section>
<section id="insertparachainerror">
<span id="id10"></span><h3>insertParachainError<a class="headerlink" href="#insertparachainerror" title="Permalink to this headline"></a></h3>
<p>Governance inserts an error for the BTC Parachain manually.</p>
<section id="id11">
<h4>Specification<a class="headerlink" href="#id11" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">insertParachainError(ErrorCode)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ErrorCode</span></code>: the ErrorCode to be added to the set of errors of the BTC-Parachain.</p></li>
</ul>
</section>
</section>
<section id="removeparachainerror">
<span id="id12"></span><h3>removeParachainError<a class="headerlink" href="#removeparachainerror" title="Permalink to this headline"></a></h3>
<p>Governance removes an error for the BTC Parachain manually.</p>
<section id="id13">
<h4>Specification<a class="headerlink" href="#id13" title="Permalink to this headline"></a></h4>
<p><em>Function Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">removeParachainError(ErrorCode)</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ErrorCode</span></code>: the ErrorCode to be removed from the set of errors of the BTC-Parachain.</p></li>
</ul>
</section>
</section>
</section>
<section id="events">
<h2>Events<a class="headerlink" href="#events" title="Permalink to this headline"></a></h2>
<section id="recoverfromerrors">
<h3>RecoverFromErrors<a class="headerlink" href="#recoverfromerrors" title="Permalink to this headline"></a></h3>
<p><em>Event Signature</em></p>
<p><code class="docutils literal notranslate"><span class="pre">RecoverFromErrors(StatusCode,</span> <span class="pre">ErrorCode[])</span></code></p>
<p><em>Parameters</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">StatusCode</span></code>: the new StatusCode of the BTC Parachain</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ErrorCode[]</span></code>: the list of current errors</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="replace.html" class="btn btn-neutral float-left" title="Replace" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="relay.html" class="btn btn-neutral float-right" title="Relay" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Interlay.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>